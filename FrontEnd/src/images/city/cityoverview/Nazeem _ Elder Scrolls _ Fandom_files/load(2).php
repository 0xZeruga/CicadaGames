$(function(){function disableCommenting(){if(wgNamespaceNumber==500&&$('#article-comments-ul li').size()>1){then=new String(then.match(/\d{8}/));var monthnames=['January','February','March','April','May','June','July','August','September','October','November','December'];var year=then.match(/^\d{4}/);var month=then.substring(4,6);var now=new Date();month--;month=monthnames[month];var day=then.match(/\d{2}$/);then=new Date(month+''+day+', '+year);var old=parseInt(now-then);old=Math.floor(old/(1000*60*60*24));if(old>30){$('#article-comm-form').attr('disabled','disabled');$('#article-comm').attr('disabled','disabled').text('This blog post hasn\'t been commented on for over 30 days. There is no need to comment.');$('#article-comm-submit').attr('disabled','disabled');$('.article-comm-reply .wikia-button .secondary').remove();}}}if(window.ArticleComments&&!ArticleComments.initOverride){ArticleComments.initOverride=ArticleComments.init;ArticleComments.init=function(){ArticleComments.
initOverride();disableCommenting();};}});if(wgNamespaceNumber==110||wgNamespaceNumber===114){function disableOldForumEdit(){if(typeof(enableOldForumEdit)!='undefined'&&enableOldForumEdit){return;}if(!document.getElementById('old-forum-warning')){return;}if(skin=='oasis'){$('#WikiaPageHeader .wikia-menu-button > a').html('Archived').removeAttr('href');return;}if(!document.getElementById('ca-edit')){return;}var editLink=null;if(skin=='monaco'){editLink=document.getElementById('ca-edit');}else if(skin=='monobook'){editLink=document.getElementById('ca-edit').firstChild;}else{return;}editLink.removeAttribute('href',0);editLink.removeAttribute('title',0);editLink.style.color='gray';editLink.innerHTML='Archived';$('span.editsection-upper').remove();}addOnloadHook(disableOldForumEdit);};function strPad(n){return String("00"+n).slice(-2);}function updateContent(content,isMod,canBlock,arr){for(var i=arr["_embedded"]["doc:posts"].length-1;i>-1;i--){var text=arr["_embedded"]["doc:posts"][i].
rawContent;var user=arr["_embedded"]["doc:posts"][i]["createdBy"].name;var userId=arr["_embedded"]["doc:posts"][i]["createdBy"].id;var epoch=arr["_embedded"]["doc:posts"][i]["creationDate"].epochSecond;var postID=arr["_embedded"]["doc:posts"][i].id;var threadID=arr["_embedded"]["doc:posts"][i].threadId;var isReported=Boolean(arr["_embedded"]["doc:posts"][i].isReported);var forumName=arr["_embedded"]["doc:posts"][i].forumName;var dt=new Date(epoch*1000);var formattedDate=strPad(dt.getHours())+":"+strPad(dt.getMinutes())+":"+strPad(dt.getSeconds());var spanDate=document.createElement("span");spanDate.className="df-date";var spanDateText=document.createTextNode(formattedDate+" — ");spanDate.appendChild(spanDateText);var aMessage=document.createElement("a");aMessage.className="df-content";aMessage.href="/d/p/"+threadID;aMessage.target="_blank";var aMessageText=document.createTextNode(text);aMessage.appendChild(aMessageText);var aUser=document.createElement("a");aUser.className="df-user";
aUser.href="/d/u/"+userId;aUser.target="_blank";var aUserText=document.createTextNode(" — "+user);aUser.appendChild(aUserText);var spanCategory=document.createElement("span");spanCategory.className="df-category";var spanCategoryText=document.createTextNode(" in "+forumName);spanCategory.appendChild(spanCategoryText);if(canBlock){var aBlock=document.createElement("a");aBlock.className="df-block";aBlock.href="/wiki/Special:Block/"+user;aBlock.target="_blank";var aBlockText=document.createTextNode(" (block)");aBlock.appendChild(aBlockText);}var par=document.createElement("p");par.className="df-entry";if(isReported){par.className+=" df-reported";}par.appendChild(spanDate);par.appendChild(aMessage);par.appendChild(aUser);par.appendChild(spanCategory);if(canBlock){par.appendChild(aBlock);}content.insertBefore(par,content.firstChild);}}function updateFeed(content,isMod,canBlock,epoch){var rcLimit=50;var dt=new Date(epoch*1000+1);var request=new XMLHttpRequest();request.onreadystatechange=
function(){if(request.readyState==4){switch(request.status){case 200:var arr=JSON.parse(request.responseText);updateContent(content,isMod,canBlock,arr);if(arr["_embedded"]["doc:posts"].length>0){epoch=arr["_embedded"]["doc:posts"][0]["creationDate"].epochSecond;}default:setTimeout(updateFeed,120000,content,isMod,canBlock,epoch);}}};request.open("GET","https://services.wikia.com/discussion/"+wgCityId+"/posts?limit="+rcLimit+"&since="+dt.toISOString()+"&page=0&responseGroup=small&reported=false&viewableOnly="+(!isMod).toString(),true);request.setRequestHeader('Accept','application/hal+json');request.send();}function initFeed(content,isMod,canBlock){var rcLimit=50;var request=new XMLHttpRequest();request.timeout=30000;request.ontimeout=function(){content.innerHTML="Unable to load discussions: The service is down or is not enabled for this domain.";};request.onreadystatechange=function(){if(request.readyState==4){switch(request.status){case 200:var arr=JSON.parse(request.responseText);
content.innerHTML='';updateContent(content,isMod,canBlock,arr);var epoch=arr["_embedded"]["doc:posts"][0]["creationDate"].epochSecond;setTimeout(updateFeed,120000,content,isMod,canBlock,epoch);break;case 404:content.innerHTML='There are no posts.';break;default:content.innerHTML="Unable to load discussions: The service is down or is not enabled for this domain.";}}};request.open("GET","https://services.wikia.com/discussion/"+wgCityId+"/posts?limit="+rcLimit+"&page=0&responseGroup=small&reported=false&viewableOnly="+(!isMod).toString(),true);request.setRequestHeader('Accept','application/hal+json');request.send();}function createDiscussionsFeed(){if(wgNamespaceNumber==-1&&wgTitle=="DiscussionsFeed"){document.title='Discussions Feed - '+wgSiteName;var canBlock=Boolean(wgUserGroups.indexOf('sysop')>-1||wgUserGroups.indexOf('staff')>-1||wgUserGroups.indexOf('helper')>-1||wgUserGroups.indexOf('vstf')>-1);var isMod=Boolean(canBlock||wgUserGroups.indexOf('threadmoderator')>-1);if(window.skin
=="oasis"){document.getElementsByClassName("page-header__title")[0].textContent="Discussions Feed";}else if(window.skin=="monobook"){document.getElementById("firstHeading").innerHTML='<h1 id="firstHeading" class="firstHeading">Discussions Feed</h1>';}var content=document.getElementById("mw-content-text");content.innerHTML='Loading feed... <img src="https://vignette.wikia.nocookie.net/wlb/images/7/74/WIP.gif/revision/latest?cb=20130731182655" /></div>';initFeed(content,isMod,canBlock);}}{var j=-1;for(var i=0;i<onloadFuncts.length&&j<0;i++){if(onloadFuncts[i].name=="createDiscussionsFeed"){j=i;}}if(j<0){addOnloadHook(createDiscussionsFeed);}};function addDProfile(text){var content=document.getElementsByClassName("noarticletext")[0];content.innerHTML=text.replace(/(?:\r\n|\r|\n)/g,'<br />');}function getUserBio(userId){var request=new XMLHttpRequest();request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){var arr=JSON.parse(request.responseText);if(Boolean(
arr.value)){addDProfile(arr.value);}}};request.open("GET","https://services.wikia.com/user-attribute/user/"+userId+"/attr/bio",true);request.send();}function getUserIdByName(username){var request=new XMLHttpRequest();request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){var arr=JSON.parse(request.responseText);userId=arr["query"]["allusers"][0].id;if(Boolean(userId)){getUserBio(userId);}}};request.open("GET","/api.php?action=query&list=allusers&aufrom="+username+"&format=json&aulimit=1",true);request.send();}function createDProfiles(){if(wgNamespaceNumber==2){var request=new XMLHttpRequest();request.onreadystatechange=function(){if(request.readyState==4&&request.status==404){var username=wgTitle
getUserIdByName(username);}};request.open("GET","/wiki/"+wgPageName,true);request.send();}}addOnloadHook(createDProfiles);;$(document).ready(function(){if(wgCategories.indexOf("3D Enabled")>-1){$("img.pi-image-thumbnail").first().replaceWith("<div id=\"object-rotator\"><img src=\"http://elderscrolls.wikia.com/wiki/Special:FilePath/3Ddef.png?width=214px\" style=\"position: absolute; bottom: 0; left: 0; opacity: 0.1\" /></div>");$("#object-rotator").css("background-image","url(\"http://elderscrolls.wikia.com/wiki/Special:FilePath/"+wgPageName+"_3D.png\")");$("#object-rotator").on("mousemove",function(e){if(e.buttons==1){window.newPos=Math.floor(e.pageX/10);if(window.newPos>window.oldPos){var position=parseInt($("#object-rotator").css("background-position"),10);$("#object-rotator").css("background-position",(position+270).toString()+"px");}else if(window.newPos<window.oldPos){var position=parseInt($("#object-rotator").css("background-position"),10);$("#object-rotator").css(
"background-position",(position-270).toString()+"px");}window.oldPos=window.newPos;}});}});;(function($){$('.insertusername').html(wgUserName);})(this.jQuery);function substUsernameTOC(){var toc=document.getElementById('toc');var userpage=document.getElementById('pt-userpage');if(!userpage||!toc)return;var username=userpage.firstChild.firstChild.nodeValue;var elements=getElementsByClass('toctext',toc,'span');for(var i=0;i<elements.length;i++)elements[i].firstChild.nodeValue=elements[i].firstChild.nodeValue.replace('<insert name here>',username);};var supportNum=$("img[data-image-name='Voting-support.svg']").length-$("div.quote img[data-image-name='Voting-support.svg']").length-$("li.SpeechBubble.message.hide.message-removed img[data-image-name='Voting-support.svg']").length+$("li.SpeechBubble.message.hide.message-removed div.quote img[data-image-name='Voting-support.svg']").length-2;var neutralNum=$("img[data-image-name='Voting-neutral.svg']").length-$(
"div.quote img[data-image-name='Voting-neutral.svg']").length-$("li.SpeechBubble.message.hide.message-removed img[data-image-name='Voting-neutral.svg']").length+$("li.SpeechBubble.message.hide.message-removed div.quote img[data-image-name='Voting-neutral.svg']").length-2;var opposeNum=$("img[data-image-name='Voting-oppose.svg']").length-$("div.quote img[data-image-name='Voting-oppose.svg']").length-$("li.SpeechBubble.message.hide.message-removed img[data-image-name='Voting-oppose.svg']").length+$("li.SpeechBubble.message.hide.message-removed div.quote img[data-image-name='Voting-oppose.svg']").length-2;if(supportNum==1){$("#support_num").html(supportNum+" vote");}else{$("#support_num").html(supportNum+" votes");}if(neutralNum==1){$("#neutral_num").html(neutralNum+" vote");}else{$("#neutral_num").html(neutralNum+" votes");}if(opposeNum==1){$("#oppose_num").html(opposeNum+" vote");}else{$("#oppose_num").html(opposeNum+" votes");}var supportBar=(supportNum/(supportNum+neutralNum+opposeNum
))*100;var neutralBar=(neutralNum/(supportNum+neutralNum+opposeNum))*100;var opposeBar=(opposeNum/(supportNum+neutralNum+opposeNum))*100;$("#support_bar").width(supportBar+"%");$("#neutral_bar").width(neutralBar+"%");$("#oppose_bar").width(opposeBar+"%");;window.storagePresent=(typeof(globalStorage)!='undefined');function storePageName(){window.pageName=wgPageName;}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};function arrayFind(array,value){for(var i=0;i<array.length;i++){if(array[i]==value)return i;}return-1;}function arrayRemove(array,value){var i=arrayFind(array,value);if(i!=-1)array.splice(i,1);}function ContentLoader(){this.cache=!0;}ContentLoader.prototype.enableCache=function(caching){this.cache=(caching==null)?true:this.cache;}
ContentLoader.prototype.createRequest=function(){if(typeof(XMLHttpRequest)!='undefined'){return new XMLHttpRequest();}else if(typeof(ActiveXObject)!='undefined'){return new ActiveXObject("Msxml2.XMLHTTP");}return null;}
ContentLoader.prototype.send=function(url,postdata,contentType){var method=(postdata==null)?'GET':'POST';this.request=this.createRequest();this.request.open(method,url);if(!this.cache)this.request.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");var request=this.request;var loader=this;if(postdata==null){if(contentType==null)contentType='application/x-www-form-urlencoded';request.setRequestHeader('Content-type',contentType);}var f=function(){if(request.readyState==4){loader.text=request.responseText;loader.document=request.responseXML;request=null;loader.request=null;loader.callback();}}
this.request.onreadystatechange=f;this.request.send(postdata);}
function getElementsByClass(searchClass,node,tag){var classElements=new Array();if(node==null)node=document;if(tag==null)tag='*';var els=node.getElementsByTagName(tag);var elsLen=els.length;var tester=new ClassTester(searchClass);for(i=0,j=0;i<elsLen;i++){if(tester.isMatch(els[i])){classElements[j]=els[i];j++;}}return classElements;}function ClassTester(className){this.regex=new RegExp("(^|\\s)"+className+"(\\s|$)");}ClassTester.prototype.isMatch=function(element){return this.regex.test(element.className);}
function queryString(p){var re=RegExp('[&?]'+p+'=([^&]*)');var matches;if(matches=re.exec(document.location)){try{return decodeURI(matches[1]);}catch(e){}}return null;}function requestComboFill(id,page){var loader=new ContentLoader();loader.comboID=id;loader.callback=onComboDataArrival;loader.send('/index.php?title='+page+'&action=raw&ctype=text/plain');}function onComboDataArrival(){fillCombo(this.text,this.comboID);}function fillCombo(text,comboid){var combo=document.getElementById(comboid);var lines=text.split("\n");for(var i=0;i<lines.length;i++){var value=lines[i].indexOf("-- ")==0?lines[i].substring(3):"";var option=document.createElement('option');option.setAttribute('value',value);option.appendChild(document.createTextNode(lines[i]));combo.appendChild(option);}}function doPreload(pagename){var loader=new ContentLoader();loader.callback=onPreloadArrival;loader.send('/index.php?title='+pagename+'&action=raw&ctype=text/plain');}function insertAtCursor(myField,myValue){if(document.
selection){myField.focus();sel=document.selection.createRange();sel.text=myValue;}else if(myField.selectionStart||myField.selectionStart=='0'){var startPos=myField.selectionStart;var endPos=myField.selectionEnd;myField.value=myField.value.substring(0,startPos)+myValue+myField.value.substring(endPos,myField.value.length);}else{myField.value+=myValue;}}function onPreloadArrival(){insertAtCursor(document.getElementById('wpTextbox1'),this.text);}function getFirstHeading(){var elements=getElementsByClass('firstHeading',document.getElementById('content'),'h1');return(elements!=null&&elements.length>0)?elements[0]:null;}function getParentByClass(className,element){var tester=new ClassTester(className);var node=element.parentNode;while(node!=null&&node!=document){if(tester.isMatch(node))return node;node=node.parentNode;}return null;}function rewriteSearchFormLink(){var links=document.getElementById('searchform').getElementsByTagName('a');if(links.length>0)links[0].href=
"/index.php?title=Special:Search&adv=1";}function substUsername(){var spans=getElementsByClass('insertusername',null,'span');for(var i=0;i<spans.length;i++){spans[i].innerHTML=wgUserName;}}function rewriteHover(){var gbl=document.getElementById("hover-global");if(gbl==null)return;var nodes=getElementsByClass("hoverable",gbl);for(var i=0;i<nodes.length;i++){nodes[i].onmouseover=function(){this.className+=" over";}
nodes[i].onmouseout=function(){this.className=this.className.replace(new RegExp(" over\\b"),"");}}}function initFunctionsJS(){storePageName();};(function($){"use strict";var conf,editTools,$sections;conf={initialSubset:window.EditTools_initial_subset===undefined?window.EditTools_initial_subset:0};editTools={setup:function(){var $container,$select,initial;$container=$('#mw-edittools-charinsert');if(!$container.length){return;}$sections=$container.find('.mw-edittools-section');if($sections.length<=1){return;}$select=$('<select>').css('display','inline');initial=conf.initialSubset;if(isNaN(initial)||initial<0||initial>=$select.length){initial=0;}$sections.each(function(i,el){var $section,sectionTitle,$option;$section=$(el);sectionTitle=$section.data('sectionTitle');$option=$('<option>').text(sectionTitle).prop('value',i).prop('selected',i===initial);$select.append($option);});$select.change(editTools.handleOnchange);$container.prepend($select);editTools.chooseSection(initial);},
handleOnchange:function(){editTools.chooseSection(Number($(this).val()));return true;},chooseSection:function(sectionNr){var $choise=$sections.eq(sectionNr);if($choise.length!==1){return;}if(!$choise.data('charInsert.buttonsMade')){$choise.data('charInsert.buttonsMade',true);editTools.makeButtons($choise);}$choise.show();$sections.not($choise).hide();},makeButtons:function($section){var $links;if(!$section.length){return;}$links=$section.find('a');$links.each(function(i,a){var $a,button;$a=$(a);button=document.createElement('input');button.type='button';button.onclick=a.onclick;button.value=$a.text();$a.replaceWith(button);});}};$(document).ready(editTools.setup);}(jQuery));;if(!RegExp.escape)(function(RegExp){"use strict";var r=/[\.\?\*\+\[\]\(\)\{\}\\\-\|\^\$]/g;RegExp.escape=function(str){return(str+'').replace(r,'\\$&');};})(RegExp);if(window.SignatureCheckJS||window.SignatureCheckJS===void 0)(function(window,$,mw,config){"use strict";var haveForum=!1,sectionEdit,sectionNum;if((
{edit:1,editredlink:1,submit:1})[mw.config.get('wgAction')]!==1)return;var namespace=mw.config.get('wgNamespaceNumber');if((namespace&1)!==1){if(namespace!==mw.config.get('wgNamespaceIds').forum)return;haveForum=!0;}if((namespace>=200)||(namespace<0))return;if($.getUrlVar('undo'))return;sectionEdit=(/(?:^\?|&)section=([^&]+)(?:&|$)/).exec(window.location.search);sectionNum=sectionEdit&&+sectionEdit[1];if(sectionEdit){if(sectionNum!==sectionNum){sectionNum=((/^(?:\d|new$)/).test(sectionEdit[1])?'new':0);}}var log=(window.console&&function(){var args=Array.prototype.slice.call(arguments);args.unshift('SIGNATURECHECK:');return window.console.log.apply(window.console,args);})||$.noop;config=$.extend({preamble:'There are a few potential problems with your edit:\n\n',epilogue:'\nAre you sure you want to post this anyway?\n[Violating policy may incur a warning]',noForumheader:
'!! There is no forum header on this forum page. You should not create forum pages without the header since they will not actually show up in the forum list.\n',noSignature:'It looks like you forgot to sign your reply. Use ~~~~ to sign.\n',forumheader:'Forumheader',checkSignature:!0},config);if(typeof(config.forumheader)!=='string'&&config.forumheader){config.forumheader=!1;log('Forumheader is not a string');}function escapeWikiTitleForRegex(str){str+='';var u=str.charAt(0).toUpperCase(),l=u.toLowerCase();if(u!==l){u='['+u+l+']';str=str.substr(1);}else{u='';}return u+RegExp.escape(str);}var start;if(({wikia:1,oasis:1})[mw.config.get('skin')]===1){start=function(f){function callback(){window.GlobalTriggers.unbind('WikiaEditorReady',callback);var editor=window.WikiaEditor&&window.WikiaEditor.getInstance('wpTextbox1'),getState;if(editor&&editor.ck){getState=function(){var $VE=null,text;if(editor.ck.document){$VE=$(editor.ck.document.$.body);if($VE.find('pre').length){text=$VE.clone()
;text.find('pre').remove();text=text.text();}else{text=$VE.text();}}else if(editor.ck.textarea){text=$(editor.ck.textarea.$).val();}if(text===void 0){log('Failsafe tripped. WikiaEditor is not behaving correctly? This may not work properly.');text=$('#wpTextbox1').val();}return{$VE:$VE,text:text};};}else{log('Cannot connect to WikiaEditor. Will try standard MediaWiki instead.');getState=function(){return{$VE:null,text:$('#wpTextbox1').val()};};}try{f(getState);}catch(e){log('Internal Crash:',e,e.stack);}}window.GlobalTriggers.bind('WikiaEditorReady',callback);};}else{start=function(f){$(function($){try{return f(function(){return{$VE:null,text:$('#wpTextbox1').val()};});}catch(e){log('Internal Crash:',e,e.stack);}});};}start(function(getState){var $form=$('#wpSave').closest('form');$form.on('submit.CheckSignature',function(evt){var problems=config.preamble,haveProblems=!1;var $VE=getState(),text=$VE.text;$VE=$VE.$VE;if(!$VE){text=text.replace(
/<nowiki\s*>(?:.|\n)*?<\/nowiki\s*>|<!--(?:.|\n)*?-->/g,'');}if(haveForum&&(!sectionEdit||sectionNum===0)&&typeof(config.forumheader)==='string'&&config.forumheader){var headerMissing=!1;if(!$VE){headerMissing=!(new RegExp('\\{\\{\\s*'+escapeWikiTitleForRegex(config.forumheader)+'\\s*\\|(?:.|\\n)*?\\}\\}').test(text));}else{var scannerRegex=new RegExp('^'+escapeWikiTitleForRegex(config.forumheader)+'$');headerMissing=$VE.find('.placeholder.placeholder-double-brackets').filter(function(){return scannerRegex.test(JSON.parse(window.decodeURIComponent(this.getAttribute('data-rte-meta'))).title);}).length===0;}if(headerMissing){problems+=config.noForumheader;haveProblems=!0;}}if(config.checkSignature&&!$form.find('#wpMinoredit').prop('checked')&&text.indexOf('~~~')===-1){problems+=config.noSignature;haveProblems=!0;}if(haveProblems){problems+=config.epilogue;if(!confirm(problems)){evt.preventDefault();evt.stopImmediatePropagation();}}});var events=$._data($form[0],'events').submit;
events.unshift(events.pop());events=null;});})(window,jQuery,mediaWiki,window.SignatureCheckJS);;require(['jquery','mw','wikia.window','wikia.tracker','BannerNotification',require.optional('ext.wikia.design-system.loading-spinner')],function($,mw,window,tracker,banner,spinner){if(window.AdvisorLoaded){return;}window.AdvisorLoaded=!0;var Advisor={config:mw.config.get(['wgCityId','wgContentLanguage','wgNamespaceNumber','wgUserId','wgUserName']),loading:4,preload:function(){if(!(--this.loading)){window.dev.i18n.loadMessages('Advisor').then(this.init.bind(this));}},init:function(i18n){if(this.config.wgUserId===null){return;}this.api=new mw.Api();this.i18n=i18n;if(!localStorage.getItem('Advisor-notificationDismissed')){this.displayNotification();}if([2,3,1200].indexOf(this.config.wgNamespaceNumber)!==-1){this.addRailModule();}var self=this;$('.advisorCardPlaceholder').each(function(){self.buildAdvisorCard(this);});mw.hook('Dashboard.loading').add(Advisor.addDashboardCard.bind(Advisor));},
track:tracker.buildTrackingFunction({category:'advisor',trackingMethod:'analytics'}),addRailModule:function(){var $rail=$('#WikiaRail');if(!$rail.length){return;}if(!$rail.hasClass('loaded')){$rail.on('afterLoad.rail',this.addRailModule.bind(this));return;}var $ad=$rail.find('#top-right-boxad-wrapper');var placeholder=document.createElement('div');var $module=$('<section>',{class:'rail-module'}).append(placeholder);if($ad.length){$ad.after($module);}else{$rail.prepend($module);}this.buildAdvisorCard(placeholder,true);},buildAdvisorCard:function(placeholder,railModule){railModule=railModule===!0;var self=this;this.getAdvisor().done(function(advisor){placeholder.parentNode.replaceChild(window.dev.ui({type:'div',classes:['dash-box','advisorCard'],data:{type:'contribute'},children:[{type:'header',classes:['top'],children:[{type:'b',classes:['type'],text:self.i18n.msg('card-select-type').plain()},{type:'div',classes:['dashHeader'],text:self.i18n.msg('card-select-title').plain()}],},{type:
'p',text:self.i18n.msg('card-select-description').plain()},{type:'footer',children:[{type:'a',attr:{title:self.i18n.msg('card-select-action').plain()},classes:['wds-button','wds-is-text','wds-is-secondary'],children:[window.dev.wds.icon('avatar-small')],events:{click:function(){self.track({action:tracker.ACTIONS.CLICK,label:(railModule?'railcard':'welcomecard')+'-change'});self.launchWizard();}},condition:advisor},{type:'a',classes:advisor?['wds-button','wds-is-text']:['wds-button','joinAdvisorProgram'],children:[window.dev.wds.icon(advisor?'message-small':'avatar-small'),{type:'span',text:self.i18n.msg(advisor?'card-contact-action':'card-select-action').plain()}],events:{click:function(){self.track({action:tracker.ACTIONS.CLICK,label:(railModule?'railcard':'welcomecard')+'-'+(advisor?'contact':'select')});if(advisor){self.launchContactAdvisor();}else{self.launchWizard();}}}}]}]}),placeholder);self.track({action:tracker.ACTIONS.IMPRESSION,label:(railModule?'railcard':'welcomecard')+'-'
+(advisor?'contact':'select')});});},displayNotification:function(){var notification=new banner(this.i18n.msg('notification').parse(),'notify');var self=this;notification.onClose(function(){self.track({action:tracker.ACTIONS.CLOSE,label:'notification'});localStorage.setItem('Advisor-notificationDismissed',true);});notification.show();notification.$element.find('.wds-banner-notification__text a').on('click',function(e){e.preventDefault();self.track({action:tracker.ACTIONS.CLICK,label:'notification-link'});localStorage.setItem('Advisor-notificationDismissed',true);self.launchWizard(true);});this.track({action:tracker.ACTIONS.IMPRESSION,label:'notification'});},createWizard:function(placeholder,reload,choose,advisors){var self=this;var alreadyChecked=!1;function advisorSelectItem(user){var id='advisor-'+(user?user.id:'none');var checked=!alreadyChecked&&(!user||(self.advisor&&self.advisor.id===user.id));alreadyChecked=alreadyChecked||checked;return{type:'label',attr:{'for':id},children
:[{type:'input',attr:Object.assign({type:'radio',name:'advisor',id:id,value:user?user.id:''},checked?{checked:''}:{})},{type:'div',classes:['wds-avatar'],children:[{type:'img',classes:['wds-avatar__image'],attr:{src:user?user.avatar:''},condition:user}]},{type:'span',children:[{type:user?'#text':'i',text:user?user.name:self.i18n.msg('dialog-select-none').plain()},{type:'small',text:self.i18n.msg('dialog-select-globaladvisor').plain(),condition:user&&user.global}]},{type:'a',classes:['wds-button','wds-is-text'],attr:{href:user?'https://community.fandom.com/wiki/User:'+mw.util.wikiUrlencode(user.name):''},text:'User page',events:{click:function(){self.track({action:tracker.ACTIONS.CLICK,label:'select-dialog-userpage'});self.launchContactAdvisor(user);}},condition:user},{type:'a',classes:['wds-button','wds-is-text'],text:'Message',events:{click:function(){self.track({action:tracker.ACTIONS.CLICK,label:'select-dialog-contact'});self.launchContactAdvisor(user);}},condition:user}]};}var tab=
choose?1:0;function switchTabs(){var $this=$(this);if($this.hasClass('is-active')){return;}tab=$this.data('id');self.track({action:tracker.ACTIONS.CLICK,label:'select-dialog-switch',value:tab});$this.parent().find('.switcher-button.is-active').removeClass('is-active');$this.parent().parent().parent().find('.wds-dialog__content:not( .is-hidden )').addClass('is-hidden');$this.parent().parent().parent().find('.wds-dialog__content[data-id='+$this.data('id')+']').removeClass('is-hidden');$this.addClass('is-active');}var advisorList=[];advisors.forEach(function(e){advisorList.push(advisorSelectItem(e));});advisorList.push(advisorSelectItem());var dialog=window.dev.ui({type:'div',classes:['wds-dialog__curtain','dashboardDialog'],attr:{id:'advisorSelectDialog'},children:[{type:'div',classes:['wds-dialog__wrapper'],children:[{type:'div',classes:['wds-dialog__title'],text:self.i18n.msg('dialog-select-title').plain()},{type:'div',classes:choose?['wds-dialog__content','is-hidden']:[
'wds-dialog__content'],text:self.i18n.msg('dialog-select-info').plain(),data:{id:0}},{type:'div',classes:choose?['wds-dialog__content']:['wds-dialog__content','is-hidden'],children:[{type:'div',classes:['advisorSelect-header'],text:self.i18n.msg('dialog-select-header').plain()},{type:'div',classes:['advisorSelect'],children:advisorList}],data:{id:1}},{type:'div',classes:['wds-dialog__actions'],children:[{type:'div',classes:['switcher'],children:[{type:'div',classes:choose?['switcher-button']:['switcher-button','is-active'],text:self.i18n.msg('dialog-select-tab-info').plain(),data:{id:0},events:{click:switchTabs}},{type:'div',classes:choose?['switcher-button','is-active']:['switcher-button'],text:self.i18n.msg('dialog-select-tab-choose').plain(),data:{id:1},events:{click:switchTabs}}]},{type:'a',classes:['wds-button','wds-is-text','wds-dialog__actions-button'],text:self.i18n.msg('dialog-cancel').plain(),events:{click:function(){self.track({action:tracker.ACTIONS.CLOSE,label:
'select-dialog'});dialog.remove();}}},{type:'a',classes:['wds-button','wds-dialog__actions-button'],text:self.i18n.msg('dialog-select-action').plain(),events:{click:function(){if(tab===0){switchTabs.call(dialog.querySelector('div.switcher-button[data-id="1"]'));return;}var id=dialog.querySelector('input[type=radio]:checked').value;this.disabled=!0;var newAdvisor=advisors.find(function(e){return e.id==id;});self.setAdvisor(newAdvisor).done(function(){new banner('Your advisor assignment has been updated.','confirm').show();self.track({action:tracker.ACTIONS.SUBMIT,label:'select-dialog-'+(newAdvisor?self.advisor?'changed':'assigned':'removed')});self.advisor=newAdvisor;dialog.remove();if(reload){window.location.reload();}}).fail(function(){self.track({action:tracker.ACTIONS.CLOSE,label:'select-dialog'});dialog.remove();});}}}]}]}]});this.track({action:tracker.ACTIONS.OPEN,label:'select-dialog'});placeholder.parentNode.replaceChild(dialog,placeholder);return dialog;},launchWizard:
function(reload){var placeholder=window.dev.ui({type:'div',classes:['wds-dialog__curtain','dashboardDialog'],children:[{type:'div',classes:['wds-dialog__wrapper'],children:[{type:'div',classes:['wds-dialog__content'],html:spinner?new spinner(38,2).html.replace('wds-block','wds-spinner__block').replace('wds-path','wds-spinner__stroke'):''}]}]});document.body.appendChild(placeholder);$.when(this.getAdvisor(),this.getAvailableAdvisors()).done(this.createWizard.bind(this,placeholder,reload));},launchContactAdvisor:function(advisor){var self=this;var dialog=window.dev.ui({type:'div',classes:['wds-dialog__curtain','dashboardDialog'],attr:{id:'advisorContactDialog'},children:[{type:'div',classes:['wds-dialog__wrapper'],children:[{type:'div',classes:['wds-dialog__title'],text:self.i18n.msg('dialog-contact-title').plain()},{type:'div',classes:['wds-dialog__content'],children:[{type:'b',text:self.i18n.msg('dialog-contact-header').plain()},{type:'div',classes:['wds-textarea'],children:[{type:
'span',classes:['wds-textarea__hint'],text:self.i18n.msg('dialog-contact-form-title-label').plain()},{type:'div',classes:['wds-textarea__field-wrapper'],children:[{type:'textarea',classes:['wds-textarea__field'],attr:{id:'advisorContact-title',placeholder:self.i18n.msg('dialog-contact-form-title-placeholder').plain(),maxlength:100,rows:1,required:''}}]}]},{type:'div',classes:['wds-textarea'],children:[{type:'span',classes:['wds-textarea__hint'],text:self.i18n.msg('dialog-contact-form-body-label').plain()},{type:'div',classes:['wds-textarea__field-wrapper'],children:[{type:'textarea',classes:['wds-textarea__field'],attr:{id:'advisorContact-body',placeholder:self.i18n.msg('dialog-contact-form-body-placeholder').plain(),maxlength:1000,rows:6,required:''}}]}]}]},{type:'div',classes:['wds-dialog__actions'],children:[{type:'a',classes:['wds-button','wds-is-text','wds-dialog__actions-button'],text:self.i18n.msg('dialog-cancel').plain(),events:{click:function(){self.track({action:tracker.
ACTIONS.CLOSE,label:'contact-dialog'});dialog.remove();}}},{type:'a',classes:['wds-button','wds-dialog__actions-button'],children:[window.dev.wds.icon('message-small'),{type:'span',text:self.i18n.msg('dialog-contact-action').plain()}],events:{click:function(){this.disabled=!0;self.postToDiscussions({title:document.getElementById('advisorContact-title').value,body:document.getElementById('advisorContact-body').value,mention:advisor}).done(function(post){new banner('<a href="/f/p/'+post.id+'">'+self.i18n.msg('dialog-contact-success').plain()+'</a>','confirm').show();self.track({action:tracker.ACTIONS.SUBMIT,label:'contact-dialog'});dialog.remove();});}}}]}]}]});this.track({action:tracker.ACTIONS.OPEN,label:'contact-dialog'});document.body.appendChild(dialog);return dialog;},setAdvisor:function(advisor){if((!advisor&&!this.advisor)||(advisor&&this.advisor&&advisor.id===this.advisor.id)){return new $.Deferred().reject();}localStorage.setItem('Advisor-notificationDismissed',true);var self
=this;return $.when(this.api.post({action:'edit',title:'User:'+this.config.wgUserName+'/advisor',text:advisor?advisor.name:'',token:mw.user.tokens.get('editToken')}),advisor?this.postToDiscussions({title:self.i18n.msg('post-select-title').plain()+this.config.wgUserName,body:self.i18n.msg('post-select-body').plain(),mention:advisor}):new $.Deferred().resolve());},getUserIdsAndAvatars:function(names){var deferred=new $.Deferred();if(typeof names==='string'){names=[names];}this.api.get({action:'query',list:'users',ususers:names.join('|')}).done(function(r){if(r.error||!r.query.users.length){deferred.resolve([]);return;}var out=[];var ids=[];r.query.users.forEach(function(e){out.push({id:e.userid,name:e.name,avatar:null});ids.push(e.userid);});$.ajax({type:'GET',url:'/api/v1/User/Details',data:{ids:ids.join(',')},dataType:'json'}).done(function(r){if(r.exception||!r.items.length){deferred.resolve(out);return;}r.items.forEach(function(e,i){out[i].avatar=e.avatar;});deferred.resolve(out);});
});return deferred;},getAdvisor:function(){var deferred=new $.Deferred();var self=this;if(this.advisor){deferred.resolve(this.advisor);return deferred;}this.api.get({action:'query',titles:'User:'+this.config.wgUserName+'/advisor',prop:'revisions',rvprop:'content',rvlimit:1}).done(function(r){if(r.error){deferred.resolve(null);return;}var page=Object.values(r.query.pages)[0];if(page.hasOwnProperty('missing')||page.revisions[0]['*']===''){deferred.resolve(null);return;}self.getUserIdsAndAvatars(page.revisions[0]['*']).done(function(advisor){if(!advisor.length){advisor=null;}self.advisor=advisor[0];deferred.resolve(self.advisor);});});return deferred;},getAvailableAdvisors:function(){var deferred=new $.Deferred();var self=this;if(this.availableAdvisors){deferred.resolve(this.availableAdvisors);return deferred;}$.when(new $.Deferred(function(sudeferred){self.api.get({action:'query',meta:'allmessages',ammessages:'Custom-Advisors'}).done(function(r){if(r.error||r.query.allmessages[0].
hasOwnProperty('missing')){sudeferred.resolve([]);return;}self.getUserIdsAndAvatars(r.query.allmessages[0]['*'].split('\n')).done(function(advisors){sudeferred.resolve(advisors);});})}),new $.Deferred(function(sudeferred){$.ajax({url:'https://community.fandom.com/api.php',data:{action:'query',meta:'allmessages',ammessages:'Advisors.json',format:'json'},dataType:'jsonp'}).done(function(r){try{if(r.error||r.query.allmessages[0].hasOwnProperty('missing')){throw new exception();}var advisors=JSON.parse(r.query.allmessages[0]['*']);var names=[];advisors.forEach(function(e){if(e.lang instanceof Array&&e.lang.indexOf(self.config.wgContentLanguage)===-1){return;}names.push(e.name);});self.getUserIdsAndAvatars(names).done(function(advisors){sudeferred.resolve(advisors);});}catch(e){sudeferred.resolve([]);return;}});})).done(function(local,global){function shuffleArray(array){for(var i=0;i<array.length-1;++i){var j=Math.floor(Math.random()*(array.length-i)+i);var temp=array[i];array[i]=array[j];
array[j]=temp;}return array;}self.availableAdvisors=shuffleArray(local);shuffleArray(global).forEach(function(e){if(local.find(function(l){return e.id===l.id})){return;}e.global=!0;self.availableAdvisors.push(e);});deferred.resolve(self.availableAdvisors);});return deferred;},postToDiscussions:function(options){var deferred=new $.Deferred();var data={title:options.title||'',body:options.body||'',siteId:this.config.wgCityId,forumId:this.config.wgCityId};if(options.mention){data.attachments={atMentions:[{id:options.mention.id}]};data.jsonModel=JSON.stringify({type:'doc',content:[{type:'paragraph',content:[{type:'text',marks:[{type:'mention',attrs:{userId:options.mention.id,userName:options.mention.name}}],text:'@'+options.mention.name},{type:'text',text:' '+data.body}]}]});data.body='@'+options.mention.name+' '+data.body;}var self=this;$.when(this.api.get({action:'query',meta:'allmessages',ammessages:'Custom-Advisors-board'}),$.ajax({type:'GET',url:
'https://services.fandom.com/discussion/'+this.config.wgCityId+'/forums',dataType:'json',})).done(function(r1,r2){var board=self.config.wgCityId;try{if(!r1[0].error&&!r1[0].query.allmessages[0].hasOwnProperty('missing')){var temp=r1[0].query.allmessages[0]['*'];var boards=r2[0]._embedded['doc:forum'];for(var i=0;i<boards.length;++i){if(boards[i].id==temp){board=temp;data.forumId=board;break;}}}}catch(e){}$.ajax({type:'POST',url:'https://services.fandom.com/discussion/'+self.config.wgCityId+'/forums/'+board+'/threads',data:JSON.stringify(data),contentType:'application/json',dataType:'json',xhrFields:{withCredentials:!0}}).done(deferred.resolve);});return deferred;},addDashboardCard:function(){var self=this;this.getAdvisor().done(function(advisor){var card=null;if(advisor){card=new Dashboard.ProfileCard({id:'dashboardCommunity-advisor',title:advisor.name,description:self.i18n.msg('card-contact-description').plain(),avatar:advisor.avatar,track:!1,action:{text:self.i18n.msg(
'card-contact-action').plain(),icon:'message-small',handler:function(){self.track({action:tracker.ACTIONS.CLICK,label:'dashboardcard-contact'});self.launchContactAdvisor(advisor);}},secondaryAction:{tooltip:self.i18n.msg('card-select-action').plain(),icon:'avatar-small',handler:function(){self.track({action:tracker.ACTIONS.CLICK,label:'dashboardcard-change'});self.launchWizard(true);}}});}else{card=new Dashboard.ContributeCard({id:'dashboardCommunity-noadvisor',title:self.i18n.msg('card-select-title').plain(),type:self.i18n.msg('card-select-type').plain(),description:self.i18n.msg('card-select-description').plain(),track:!1,action:{text:self.i18n.msg('card-select-action').plain(),icon:'avatar-small',primary:!0,handler:function(){self.track({action:tracker.ACTIONS.CLICK,label:'dashboardcard-select'});self.launchWizard(true);}}});}mw.hook('Dashboard.ui').add(function(){$('#dashboardCommunity > .boxes').append(card.render());self.track({action:tracker.ACTIONS.IMPRESSION,label:advisor
?'dashboardcard-contact':'dashboardcard-select'});});});}};mw.hook('dev.i18n').add(Advisor.preload.bind(Advisor));mw.hook('dev.ui').add(Advisor.preload.bind(Advisor));mw.hook('dev.wds').add(Advisor.preload.bind(Advisor));mw.loader.using(['mediawiki.api','mediawiki.util']).done(Advisor.preload.bind(Advisor));importArticles({type:'script',articles:['u:dev:MediaWiki:I18n-js/code.js','u:dev:MediaWiki:UI-js/code.js','u:dev:MediaWiki:WDSIcons/code.js',]},{type:'style',articles:['u:dev:MediaWiki:Dashboard.css','u:dev:MediaWiki:Advisor.css',]});});;(function($){'use strict';var config=mw.config.get(['stylepath','wgAction','wgArticleId','wgNamespaceNumber','wgPageName','wgTitle']);if(window.ArchiveToolLoaded||(config.wgNamespaceNumber%2===0||config.wgNamespaceNumber===-1)&&config.wgNamespaceNumber!==110||config.wgAction!=='view'&&config.wgAction!=='purge'){return;}window.ArchiveToolLoaded=!0;var ArchiveTool={config:$.extend(true,{archiveListTemplate:window.archiveListTemplate||'ArchiveList',
archivePageTemplate:window.archivePageTemplate||'ArchivePage',archiveSubpage:'Archive',userLang:!0},window.ArchiveToolConfig),hook:function(i18n){$.when(i18n.loadMessages('ArchiveTool'),mw.loader.using('mediawiki.api')).then($.proxy(this.init,this));},init:function(i18n){this.i18n=i18n;if(!this.config.userLang){i18n.useContentLang();}this.api=new mw.Api();var controls=($('#WikiaUserPagesHeader').length?'.UserProfileActionButton':'#PageHeader')+' .wds-dropdown__content > ul';if(config.wgNamespaceNumber===3){controls=($('#WikiaUserPagesHeader').length?'.UserProfileActionButton':'#WikiaPageHeader')+' > .wikia-menu-button > ul';}$('<li>',{id:'control_archive',click:$.proxy(this.click,this)}).append($('<a>',{id:'ca-archive',rel:'nofollow',text:i18n.msg('button').plain()})).appendTo(controls);},click:function(){this.regex=new RegExp('\\{\\{'+$.escapeRE(this.config.archiveListTemplate)+'\\}\\}');this.$container=$('#WikiaArticle').addClass('archiving').empty();this.$loading=$('<img>',{'alt':
this.i18n.msg('loading').plain(),'class':'ajax','src':config.stylepath+'/common/progress-wheel.gif'}).appendTo(this.$container);this.api.get({action:'query',prop:'revisions',titles:config.wgPageName,rvprop:'timestamp|content'}).done($.proxy(this.cbRevisions,this));},cbRevisions:function(q){this.$loading.hide();var lines=q.query.pages[config.wgArticleId].revisions[0]['*'].split('\n'),$table=$('<table>',{mousedown:$.proxy(this.tableClick,this),mouseup:$.proxy(this.tableUnclick,this)}).append($('<thead>').append($('<tr>').append($('<th>',{text:this.i18n.msg('lines').plain()}),$('<th>',{title:this.i18n.msg('sections').plain(),text:'{…}'})))).appendTo(this.$container),$body=$('<tbody>').appendTo($table),sections=[];lines.forEach(function(line,i){$body.append($('<tr>',{'class':this.regex.test(line)?'noarchive':'','line':line}).append($('<td>',{'class':'line','text':line}).append('&nbsp;')));if(i===0||/^=.+?=/.test(line)){if(i!==0){var last=sections[sections.length-1];last.end=i-1;last.
length=i-last.start;}sections.push({start:i});}},this);var last=sections[sections.length-1];last.end=lines.length-1;last.length=lines.length-last.start;sections.forEach(function(section){var tr=$body.children().eq(section.start);$('<td>',{'class':'section','rowspan':section.length}).appendTo(tr);});this.$body=$body;$('<div>',{'class':'buttons'}).append($('<a>',{'class':'wikia-button secondary','click':$.proxy(this.clickSelect,this),'text':this.i18n.msg('select').plain()}),' ',$('<a>',{'class':'wikia-button secondary','click':$.proxy(this.clickDeselect,this),'text':this.i18n.msg('deselect').plain()}),' ',$('<a>',{'class':'wikia-button','click':$.proxy(this.archive,this),'text':this.i18n.msg('save').plain()}),' ',$('<a>',{'class':'wikia-button','click':$.proxy(this.clickAbort,this),'text':this.i18n.msg('abort').plain()})).prependTo(this.$container).clone(true).appendTo(this.$container);this.clicked=!1;$('body').mouseup($.proxy(this.bodyUnclick,this));},clickAbort:function(){this.
$loading.hide();location.href=mw.util.getUrl(config.wgPageName,{action:'purge'});},clickSelect:function(e){e.preventDefault();this.$body.children('tr').addClass('archive');},clickDeselect:function(e){e.preventDefault();this.$body.children('tr').removeClass('archive');},tableClick:function(e){e.preventDefault();var $li=$(e.target).closest('tr');if(!$li.length){return;}var $section=$(e.target).closest('.section');if($section.length){var slist=$li.nextAll(':lt('+(parseInt($section.attr('rowspan'),10)-1)+')').andSelf();slist.toggleClass('archive',Boolean(slist.filter(function(){return!$(this).hasClass('archive');}).length));return;}this.clicked=!0;this.add=!$li.hasClass('archive');$li.toggleClass('archive',Boolean(this.add));},tableUnclick:function(e){if(!this.clicked){return;}var $li=$(e.target).closest('tr');if(!$li.length){return;}$li.toggleClass('archive',Boolean(this.add));},bodyUnclick:function(){this.clicked=!1;},archive:function(){var talkLines=[];var archiveLines=[];this.
$body.children().each(function(){var $this=$(this),arr=$this.hasClass('noarchive')||!$this.hasClass('archive')?talkLines:archiveLines;arr.push($this.attr('line'));});if(!this.regex.test(talkLines[0])){talkLines=['{{'+this.config.archiveListTemplate+'}}',''].concat(talkLines);}archiveLines=['{{'+this.config.archivePageTemplate+'}}',''].concat(archiveLines);this.$container.empty();this.$loading.show();this.talkContent=talkLines.join('\n');this.archiveContent=archiveLines.join('\n');this.run();},run:function(){this.archiveNo=1;this.$m=$('<p>',{text:this.i18n.msg('finding').plain()}).appendTo(this.$container);this.api.get({action:'query',list:'allpages',apnamespace:config.wgNamespaceNumber,apprefix:config.wgTitle+'/'+this.config.archiveSubpage,aplimit:'max',apdir:'ascending'}).done($.proxy(this.cbRun,this));},cbRun:function(q){$.each(q.query.allpages,$.proxy(function(_,value){var qt=parseInt(value.title.substr(config.wgPageName.length+('/'+this.config.archiveSubpage).length),10);if(qt>=
this.archiveNo){this.archiveNo=qt+1;}},this));this.archiveTitle=config.wgPageName+'/'+this.config.archiveSubpage+' '+this.archiveNo;this.$m.append(this.i18n.msg('done-using',this.archiveNo).escape());this.saveArchive();},saveArchive:function(){this.$m=$('<p>',{text:this.i18n.msg('saving').plain()}).appendTo(this.$container);this.api.post({action:'edit',title:this.archiveTitle,text:this.archiveContent,token:mw.user.tokens.get('editToken'),summary:this.i18n.inContentLang().msg('summary-from',config.wgPageName).plain(),minor:!0,createonly:!0}).done($.proxy(this.cbSaveArchive,this));},cbSaveArchive:function(q){if(q.error&&q.error.code==='articleexists'){this.$m.append(this.i18n.msg('failed').escape());this.$container.append($('<p>',{text:this.i18n.msg('exists').plain()}));return this.abort();}this.$m.append(this.i18n.msg('done').escape());this.saveTalk();},saveTalk:function(){this.$m=$('<p>',{text:this.i18n.msg('updating').plain()}).appendTo(this.$container);this.api.post({action:
'edit',title:config.wgPageName,text:this.talkContent,token:mw.user.tokens.get('editToken'),summary:this.i18n.inContentLang().msg('summary-to',this.archiveTitle).plain(),minor:!0}).done($.proxy(this.cbSaveTalk,this));},cbSaveTalk:function(q){if(q.edit.result==='Success'){this.$m.append(this.i18n.msg('done').escape());this.$loading.hide();location.href=mw.util.getUrl(config.wgPageName,{action:'purge'});}else{this.$m.append(this.i18n.msg('failed').escape());this.$container.append($('<p>',{text:this.i18n.msg('failed-delete').plain()}));this.abort();}},abort:function(){console.log(this);this.$loading.hide();this.$container.append($('<p>',{text:this.i18n.msg('aborting').plain()}),$('<p>',{html:this.i18n.msg('refresh',config.wgPageName).parse()}));}};mw.hook('dev.i18n').add($.proxy(ArchiveTool.hook,ArchiveTool));importArticles({type:'script',article:'u:dev:MediaWiki:I18n-js/code.js'},{type:'style',article:'u:dev:MediaWiki:ArchiveTool.css'});})(jQuery);;require(['jquery','mw',require.
optional('wikia.tracker'),'wikia.window',require.optional('ext.wikia.design-system.loading-spinner'),'BannerNotification'],function($,mw,tracker,window,spinner,banner){if(window.DashboardLoaded){return;}window.DashboardLoaded=!0;function DashboardSection(options){this.id=options.id;this.title=options.title||this.id&&Dashboard.i18n.msg(this.id+'-title').exists&&Dashboard.i18n.msg(this.id+'-title').plain();this.description=options.description||this.id&&Dashboard.i18n.msg(this.id+'-description').exists&&Dashboard.i18n.msg(this.id+'-description').plain();this.collapsible=options.collapsible===!0;this.cards=options.cards instanceof Array?options.cards:[];}DashboardSection.prototype.getRenderData=function(){var cardNodes=[];for(var i=0;i<this.cards.length;++i){var card=this.cards[i];if(card instanceof DashboardCard){cardNodes.push(card.getRenderData());}}return{type:'div',attr:this.id?{id:this.id}:{},classes:['dashSection'],children:[{type:'h2',text:this.title,},{type:'p',text:this.
description,condition:this.description},{type:'div',classes:['boxes'],children:cardNodes}]};};DashboardSection.prototype.render=function(){return window.dev.ui(this.getRenderData());};function DashboardCard(options){this.id=options.id;this.title=options.title||this.id&&Dashboard.i18n.msg(this.id+'-title').exists&&Dashboard.i18n.msg(this.id+'-title').plain();this.description=options.description||this.id&&Dashboard.i18n.msg(this.id+'-description').exists&&Dashboard.i18n.msg(this.id+'-description').plain();this.help=options.help||this.id&&Dashboard.i18n.msg(this.id+'-help').exists&&Dashboard.i18n.msg(this.id+'-help').plain();this.track=options.track===!0||options.track===undefined;options.action=options.action||{};this.action={text:options.action.text||this.id&&Dashboard.i18n.msg(this.id+'-action').exists&&Dashboard.i18n.msg(this.id+'-action').plain(),href:options.action.href,icon:options.action.icon,primary:options.action.primary===!0,handler:options.action.handler instanceof Function
?options.action.handler:new Function()};options.secondaryAction=options.secondaryAction||{};this.secondaryAction={href:options.secondaryAction.href,icon:options.secondaryAction.icon,tooltip:options.secondaryAction.tooltip,handler:options.secondaryAction.handler instanceof Function?options.secondaryAction.handler:new Function()};}DashboardCard.prototype.getRenderData=function(){var self=this;return{type:'div',attr:this.id?{id:this.id}:{},classes:['dash-box'],children:[{type:'header',classes:['top'],children:[{type:'div',classes:['dashHeader'],children:[{type:'#text',text:this.title}]}],},{type:'p',text:this.description,condition:this.description},{type:'footer',children:[{type:'div',classes:['wds-dropdown'],children:[{type:'div',classes:['wds-dropdown__toggle'],children:[window.dev.wds.icon('question-small')]},{type:'div',classes:['wds-dropdown__content','wds-is-left-aligned'],text:this.help}],events:{pointerenter:function(){if(self.track){Dashboard.track({action:tracker.ACTIONS.HOVER,
label:'cardHelp-'+self.id});}}},condition:this.help},{type:'a',attr:Object.assign(this.secondaryAction.href?{href:this.secondaryAction.href}:{},this.secondaryAction.tooltip?{title:this.secondaryAction.tooltip}:{}),classes:['wds-button','wds-is-text','wds-is-secondary'],children:this.secondaryAction.icon?[window.dev.wds.icon(this.secondaryAction.icon)]:[],events:{click:function(e){if(self.track){Dashboard.track({action:tracker.ACTIONS.CLICK,label:'card-secondary-'+self.id});}self.secondaryAction.handler(e);}},condition:this.secondaryAction.icon},{type:'a',attr:this.action.href?{href:this.action.href}:{},classes:this.action.primary?['wds-button']:['wds-button','wds-is-text'],children:this.action.icon?[window.dev.wds.icon(this.action.icon),{type:'span',text:this.action.text}]:[this.action.text],events:{click:function(e){if(self.track){Dashboard.track({action:tracker.ACTIONS.CLICK,label:'card-'+self.id});}self.action.handler(e);}},condition:this.action.text}]}]};};DashboardCard.prototype.
render=function(){return window.dev.ui(this.getRenderData());};function DashboardContributeCard(options){if(options.action&&options.action.text===undefined){options.action.text=Dashboard.i18n.msg('dashboardHelp-showpagelist').plain();}DashboardCard.call(this,options);this.type=options.type;}DashboardContributeCard.prototype=Object.create(DashboardCard.prototype);DashboardContributeCard.prototype.getRenderData=function(){var renderData=DashboardCard.prototype.getRenderData.call(this);if(this.type){renderData.children[0].children.unshift({type:'b',text:this.type});}renderData.data={type:'contribute'};return renderData;};function DashboardProfileCard(options){DashboardCard.call(this,options);this.avatar=options.avatar;}DashboardProfileCard.prototype=Object.create(DashboardCard.prototype);DashboardProfileCard.prototype.getRenderData=function(){var renderData=DashboardCard.prototype.getRenderData.call(this);if(this.avatar){renderData.children[0].children[0].children.unshift({type:'div',
classes:['wds-avatar'],children:[{type:'img',classes:['wds-avatar__image'],attr:{src:this.avatar}}]});}renderData.data={type:'profile'};return renderData;};function DashboardDialog(options){this.id=options.id;this.title=options.title||options.id&&Dashboard.i18n.msg(options.id+'-title').exists&&Dashboard.i18n.msg(options.id+'-title').plain();this.content=options.content||options.id&&Dashboard.i18n.msg(options.id+'-content').exists&&Dashboard.i18n.msg(options.id+'-content').plain();this.close=options.close||options.id&&Dashboard.i18n.msg(options.id+'-cancel').exists&&Dashboard.i18n.msg(options.id+'-cancel').plain();this.track=options.track!==undefined?options.track===true:!0;this.node=null;}DashboardDialog.prototype.getRenderData=function(){var self=this;if(this.track){Dashboard.track({action:tracker.ACTIONS.OPEN,label:this.id});}return{type:'div',attr:this.id?{id:this.id}:{},classes:['wds-dialog__curtain','dashboardDialog'],children:[{type:'div',classes:['wds-dialog__wrapper'],
children:[{type:'div',classes:['wds-dialog__title'],text:this.title,condition:this.title},{type:'div',classes:['wds-dialog__content'],text:this.content},{type:'div',classes:['wds-dialog__actions'],children:[{type:'a',classes:['wds-button','wds-is-text','wds-dialog__actions-button'],text:this.close||Dashboard.i18n.msg('dialog-close').plain(),events:{click:function(){if(self.track){Dashboard.track({action:tracker.ACTIONS.CLOSE,label:self.id});}self.node.remove();self.node=null;}}}]}]}]};};DashboardDialog.prototype.render=function(){this.node=document.body.appendChild(window.dev.ui(this.getRenderData()));return this.node;};function DashboardConfirmDialog(options){DashboardDialog.call(this,options);this.action=options.action;this.confirm=options.confirm||options.id&&Dashboard.i18n.msg(options.id+'-confirm').exists&&Dashboard.i18n.msg(options.id+'-confirm').plain();this.callback=options.callback;}DashboardConfirmDialog.prototype=Object.create(DashboardDialog.prototype);
DashboardConfirmDialog.prototype.getRenderData=function(){var renderData=DashboardDialog.prototype.getRenderData.call(this);var self=this;renderData.children[0].children[2].children[0].text=this.close||Dashboard.i18n.msg('dialog-cancel').plain();renderData.children[0].children[2].children.push({type:'a',attr:{href:this.action},classes:['wds-button','wds-dialog__actions-button'],text:this.confirm||Dashboard.i18n.msg('dialog-confirm').plain(),events:{click:function(){if(self.track){Dashboard.track({action:tracker.ACTIONS.CONFIRM,label:self.id});}if(self.callback instanceof Function){self.callback();}self.node.remove();self.node=null;}}});return renderData;};var Dashboard={config:mw.config.get(['wgNamespaceNumber','wgSiteName','wgTitle','wgUserId','wgUserName','wgWikiaPageActions','wgVisualEditorPreferred']),loading:4,preload:function(){if(--this.loading===0){window.dev.i18n.loadMessages('Dashboard').then(this.init.bind(this));}},init:function(i18n){this.api=new mw.Api();this.i18n=i18n;if
(this.config.wgUserId===null){this.addUserBenefits();}else{if(localStorage.getItem('Dashboard-trackRegister')){this.track({action:tracker.ACTIONS.SUCCESS,label:'benefits-register'});localStorage.removeItem('Dashboard-trackRegister');}this.addUserMenuShortcuts();}if(this.config.wgNamespaceNumber===-1&&this.config.wgTitle==='Dashboard'){$('.page-header__title').text(this.i18n.msg('dashboard').plain());document.title=this.i18n.msg('dashboard').plain()+' | '+this.config.wgSiteName+' | Fandom';if(this.config.wgUserId===null){mw.util.$content.html(this.i18n.msg('dashboard-anon').plain());this.track({action:tracker.ACTIONS.VIEW,label:'anon'});return;}mw.hook('Dashboard.loading').fire();this.renderDashboardLoading();$.when(this.getUserInfo(),$.getScript('/extensions/wikia/UserProfilePageV3/js/UserProfilePage.js')).done(this.renderDashboard.bind(this));}else if(this.config.wgUserId!==null){if(!localStorage.getItem('Dashboard-notificationDismissed')){this.displayNotification();}if(localStorage.
getItem('Dashboard-trackAddEmail')||localStorage.getItem('Dashboard-trackConfirmEmail')||localStorage.getItem('Dashboard-trackCentralUserPage')||localStorage.getItem('Dashboard-trackLocalUserPage')){this.getUserInfo();}}},track:tracker.buildTrackingFunction({category:'dashboard',action:tracker.ACTIONS.CLICK,trackingMethod:'analytics'}),addUserBenefits:function(){var self=this;$('.wds-global-navigation__user-menu > .wds-dropdown__content > .wds-list').append(window.dev.ui({type:'li',children:[{type:'div',classes:['wds-global-navigation__user-menu-dropdown-caption'],text:this.i18n.msg('benefits-caption').plain()},{type:'a',classes:['wds-button','wds-is-full-width','wds-is-secondary'],attr:{href:'#'},text:this.i18n.msg('benefits').plain(),events:{click:function(){new DashboardConfirmDialog({id:'benefitsDialog',action:'https://www.fandom.com/register?redirect='+encodeURIComponent(window.location.href),callback:function(){localStorage.setItem('Dashboard-trackRegister',true);}}).render();}}}
]})).parent().parent().on('mouseenter',function(){self.track({action:tracker.ACTIONS.IMPRESSION,label:'benefits'})});},addUserMenuShortcuts:function(){var self=this;function userMenuShortcut(options){return{type:'li',children:[{type:'a',attr:{href:options.url},text:self.i18n.msg(options.label).plain()}],events:{click:function(){self.track({action:tracker.ACTIONS.CLICK,label:options.label});}}};}$('.wds-global-navigation__user-menu > .wds-dropdown__content').addClass('wds-is-not-scrollable');var $menu=$('.wds-global-navigation__user-menu a[data-tracking-label="account.preferences"]').attr({'data-tracking-label':'Dashboard',href:mw.util.getUrl('Special:Dashboard')}).empty().append(window.dev.ui({type:'div',classes:['wds-dropdown-level-2__toggle'],children:[{type:'span',text:this.i18n.msg('dashboard').plain()},window.dev.wds.icon('menu-control-tiny',{class:'wds-dropdown-chevron'})],events:{pointerenter:function(){self.track({action:tracker.ACTIONS.HOVER,label:'usermenu'});}}})).parent().
append(window.dev.ui({type:'div',classes:['wds-dropdown-level-2__content'],children:[{type:'ul',classes:['wds-list','wds-is-linked'],children:[userMenuShortcut({url:mw.util.getUrl('Special:Dashboard'),label:'usermenu-dashboard'}),userMenuShortcut({url:mw.util.getUrl('Special:Preferences'),label:'usermenu-preferences'}),userMenuShortcut({url:mw.util.getUrl('Special:Contributions/'+this.config.wgUserName),label:'usermenu-contributions'}),userMenuShortcut({url:mw.util.getUrl('Special:Watchlist/'+this.config.wgUserName),label:'usermenu-watchlist'})]}]})).addClass(function(){var $firstLevelItem=$(this);var index=$firstLevelItem.index();var numSecondLevelItems=$firstLevelItem.find('.wds-list li').length;return(index>numSecondLevelItems-1)?'wds-is-sticked-to-parent wds-dropdown-level-2':'wds-dropdown-level-2';});mw.hook('Dashboard.usermenu').fire($menu);},displayNotification:function(){var notification=new banner(this.i18n.msg('notification').parse(),'notify');var self=this;notification.
onClose(function(){self.track({action:tracker.ACTIONS.CLOSE,label:'notification'});localStorage.setItem('Dashboard-notificationDismissed',true);});notification.show();notification.$element.find('.wds-banner-notification__text a').attr('target','_blank').on('click',function(){self.track({action:tracker.ACTIONS.CLICK,label:'notification-link'});localStorage.setItem('Dashboard-notificationDismissed',true);});this.track({action:tracker.ACTIONS.IMPRESSION,label:'notification'});},addProfileEditTracking:function(modal){this.track({action:tracker.ACTIONS.OPEN,label:'profileedit'});var self=this;var submitted=!1;var data={name:undefined,location:undefined,occupation:undefined,gender:undefined,website:undefined,twitter:undefined,fbPage:undefined,discordHandle:undefined,year:undefined,month:undefined,day:undefined};Object.keys(data).forEach(function(key){if(document.userData[key]){data[key]=document.userData[key].value;}});var $modal=$(modal);var avatar=$modal.find('.avatar').attr('src');
function onSave(){var changed=0;if(avatar!==$modal.find('.avatar').attr('src')){++changed;}Object.keys(data).forEach(function(key){if(document.userData[key]&&data[key]!==document.userData[key].value){++changed;}});if(changed){submitted=!0;self.track({action:tracker.ACTIONS.SUBMIT,label:'profileedit',value:changed});}}var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.addedNodes.forEach(function(addedNode){if(addedNode.id!=='blackout_UPPLightboxCloseWrapper'){return;}$(addedNode).find('button[data-event=save]').on('click',onSave);});mutation.removedNodes.forEach(function(removedNode){if(removedNode.id!=='blackout_UPPLightboxWrapper'){return;}if(!submitted){self.track({action:tracker.ACTIONS.CLOSE,label:'profileedit'});}observer.disconnect();});});});observer.observe(document.body,{childList:!0});$modal.find('button[data-event=save]').on('click',onSave);},renderDashboardLoading:function(){mw.util.$content.empty().append(window.dev.ui({
type:'div',attr:{id:'Dashboard',},children:[{type:'input',attr:{id:'user',type:'hidden',value:this.config.wgUserId}},{type:'input',attr:{id:'reloadUrl',type:'hidden',value:''}},{type:'input',attr:{id:'userIdentityBoxEdit',type:'hidden'}}]}),spinner?new spinner(38,2).html.replace('wds-block','wds-spinner__block').replace('wds-path','wds-spinner__stroke'):'');},renderDashboard:function(){this.track({action:tracker.ACTIONS.VIEW,label:this.user.globaleditcount>20?'olduser':'newuser'});var $dashboard=$('#Dashboard');mw.util.$content.find('.wds-spinner').remove();this.getSections().forEach(function(section){$dashboard.append(section.render());});mw.hook('Dashboard.ui').fire($dashboard);},getSections:function(){var sections=[this.getSelfSection(),this.getCommunitySection(),this.getHelpSection()];mw.hook('Dashboard.sections').fire(sections);return sections;},getSelfSection:function(){var self=this;return new DashboardSection({id:'dashboardSelf',collapsible:!0,cards:[new DashboardProfileCard(
{id:'dashboardSelf-profile',title:this.user.name,avatar:this.user.options.avatar,action:{handler:function(e){var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.addedNodes.forEach(function(addedNode){if(addedNode.id!=='blackout_UPPLightboxWrapper'){return;}observer.disconnect();self.addProfileEditTracking(addedNode);});});});observer.observe(document.body,{childList:!0});$('#userIdentityBoxEdit').trigger('click',e);}}}),new DashboardCard({id:this.user.email?this.user.emailauthenticated?'dashboardSelf-email':'dashboardSelf-unconfirmedemail':'dashboardSelf-noemail',title:this.user.email?this.user.email:this.i18n.msg('dashboardSelf-noemail-title').plain(),action:{href:mw.util.getUrl(this.user.email?this.user.emailauthenticated?'Special:Preferences':'Special:ConfirmEmail':'Special:ChangeEmail')+(this.user.emailauthenticated?'#mw-prefsection-emailv2':''),primary:!this.user.emailauthenticated,handler:function(e){if(self.user.
emailauthenticated){return;}e.preventDefault();new DashboardConfirmDialog({id:self.user.email?'dashboardSelf-unconfirmedemail-dialog':'dashboardSelf-noemail-dialog',action:mw.util.getUrl(self.user.email?'Special:ConfirmEmail':'Special:ChangeEmail'),callback:function(){localStorage.setItem(self.user.email?'Dashboard-trackConfirmEmail':'Dashboard-trackAddEmail',true);}}).render();}}}),new DashboardCard({id:this.user.centraluserpage?'dashboardSelf-centraluserpage':'dashboardSelf-nocentraluserpage',description:this.i18n.msg('dashboardSelf-centraluserpage-description').plain(),action:{href:'https://community.fandom.com/wiki/User:'+mw.util.wikiUrlencode(this.user.name)+(this.user.centraluserpage?'':this.config.wgVisualEditorPreferred?'?veaction=edit':'?action=edit'),primary:!this.user.centraluserpage,handler:function(e){if(self.user.centraluserpage){return;}e.preventDefault();new DashboardConfirmDialog({id:'dashboardSelf-nocentraluserpage-dialog',action:
'https://community.fandom.com/wiki/User:'+mw.util.wikiUrlencode(self.user.name)+(self.config.wgVisualEditorPreferred?'?veaction=edit':'?action=edit'),callback:function(){localStorage.setItem('Dashboard-trackCentralUserPage',true);}}).render();}}}),new DashboardCard({id:'dashboardSelf-preferences',action:{href:mw.util.getUrl('Special:Preferences')}})]});},getCommunitySection:function(){return new DashboardSection({id:'dashboardCommunity',cards:[new DashboardCard({id:this.user.localuserpage?'dashboardCommunity-localuserpage':'dashboardCommunity-nolocaluserpage',description:this.i18n.msg('dashboardCommunity-localuserpage-description').plain(),action:{href:mw.util.getUrl('User:'+this.user.name,(!this.user.localuserpage?this.config.wgVisualEditorPreferred?{veaction:'edit'}:{action:'edit'}:{})),primary:!this.user.localuserpage,handler:function(){localStorage.setItem('Dashboard-trackLocalUserPage',true);}}}),new DashboardCard({id:'dashboardCommunity-admins',action:{href:mw.util.getUrl(
'Special:ListAdmins')}}),this.config.wgWikiaPageActions.find(function(e){return e.id==='special:community';})?new DashboardCard({id:'dashboardCommunity-communitypage',action:{href:mw.util.getUrl('Special:Community')}}):undefined]});},getHelpSection:function(){return new DashboardSection({id:'dashboardHelp',cards:[new DashboardContributeCard({id:'dashboardHelp-wantedpages',type:this.i18n.msg('dashboardHelp-addcontent').plain(),action:{href:mw.util.getUrl('Special:WantedPages')}}),new DashboardContributeCard({id:'dashboardHelp-shortpages',type:this.i18n.msg('dashboardHelp-addcontent').plain(),action:{href:mw.util.getUrl('Special:ShortPages')}}),new DashboardContributeCard({id:'dashboardHelp-deadendpages',type:this.i18n.msg('dashboardHelp-linkcontent').plain(),action:{href:mw.util.getUrl('Special:DeadendPages')}}),new DashboardContributeCard({id:'dashboardHelp-lonelypages',type:this.i18n.msg('dashboardHelp-linkcontent').plain(),action:{href:mw.util.getUrl('Special:LonelyPages')}}),new
DashboardContributeCard({id:'dashboardHelp-withoutimages',type:this.i18n.msg('dashboardHelp-addcontent').plain(),action:{href:mw.util.getUrl('Special:WithoutImages')}}),new DashboardContributeCard({id:'dashboardHelp-uncategorizedpages',type:this.i18n.msg('dashboardHelp-linkcontent').plain(),action:{href:mw.util.getUrl('Special:UncategorizedPages')}}),]});},getUserInfo:function(){var deferred=new $.Deferred();var self=this;$.when(this.api.get({action:'query',meta:'userinfo',uiprop:'email|options'}),this.api.get({action:'query',titles:'User:'+this.config.wgUserName}),$.ajax({type:'GET',url:'https://community.fandom.com/api.php',data:{action:'query',titles:'User:'+this.config.wgUserName,format:'json'},dataType:'jsonp'}),$.ajax({type:'GET',url:mw.util.getUrl('Special:Editcount/'+this.config.wgUserName)})).done(function(userinfo,localuserpage,centraluserpage,globaleditcount){var result=!userinfo[0].error?userinfo[0].query.userinfo:{};result.localuserpage=!localuserpage[0].error&&
localuserpage[0].query.pages&&!Object.values(localuserpage[0].query.pages)[0].hasOwnProperty('missing');result.centraluserpage=!centraluserpage[0].error&&centraluserpage[0].query.pages&&!Object.values(centraluserpage[0].query.pages)[0].hasOwnProperty('missing');result.globaleditcount=Number.parseInt($('.TablePager > tbody > tr:nth-child(2) > th:nth-child(4)',globaleditcount[0]).text().replace(/,/g,''));if(localStorage.getItem('Dashboard-trackAddEmail')&&result.emailauthenticated){self.track({action:tracker.ACTIONS.SUCCESS,label:'addemail'});localStorage.removeItem('Dashboard-trackAddEmail');}if(localStorage.getItem('Dashboard-trackConfirmEmail')&&result.emailauthenticated){self.track({action:tracker.ACTIONS.SUCCESS,label:'confirmemail'});localStorage.removeItem('Dashboard-trackConfirmEmail');}if(localStorage.getItem('Dashboard-trackCentralUserPage')&&result.centraluserpage){self.track({action:tracker.ACTIONS.SUCCESS,label:'centraluserpage'});localStorage.removeItem(
'Dashboard-trackCentralUserPage');}if(localStorage.getItem('Dashboard-trackLocalUserPage')&&result.localuserpage){self.track({action:tracker.ACTIONS.SUCCESS,label:'localuserpage'});localStorage.removeItem('Dashboard-trackLocalUserPage');}self.user=result;deferred.resolve(result);});return deferred;}};mw.hook('dev.ui').add(Dashboard.preload.bind(Dashboard));mw.hook('dev.i18n').add(Dashboard.preload.bind(Dashboard));mw.hook('dev.wds').add(Dashboard.preload.bind(Dashboard));mw.loader.using(['mediawiki.util','mediawiki.api']).done(Dashboard.preload.bind(Dashboard));importArticles({type:'script',articles:['u:dev:MediaWiki:I18n-js/code.js','u:dev:MediaWiki:UI-js/code.js','u:dev:MediaWiki:WDSIcons/code.js']},{type:'style',article:'u:dev:MediaWiki:Dashboard.css'});window.Dashboard={Section:DashboardSection,Card:DashboardCard,ProfileCard:DashboardProfileCard,ContributeCard:DashboardContributeCard};});;(function(){if(window.Discord&&Discord.init)return;var blankImgUrl=mw.config.get(
'wgBlankImgUrl');var canNativelyLazyLoadImages=window.HTMLImageElement.prototype.hasOwnProperty('loading');var shouldPolyfillLazyLoadImages=!canNativelyLazyLoadImages&&window.hasOwnProperty('IntersectionObserver');window.Discord=$.extend({$rail:$('#WikiaRail'),loaded:7,onload:function(type,arg){switch(type){case'i18n':arg.loadMessages('Discord').then(this.onload.bind(this,'lang'));break;case'lang':this.i18n=arg;break;case'api':this.api=new mw.Api();this.getMessages();break;}if(--this.loaded)return;this.init();},requests:{},defaults:{theme:'light',roles:{}},messages:{},getMessages:function(){this.api.get({action:'query',list:'allpages',apnamespace:8,apprefix:'Custom-Discord-',aplimit:'max'}).then(this.onPagesLoaded.bind(this)).then(this.handleMessages.bind(this));},onPagesLoaded:function(data){var first=data.query.allpages[0],index=first?first.title.indexOf(':')+1:null,allpages=data.query.allpages.map(function(page){return page.title.slice(index);});return this.api.get({action:'query',
meta:'allmessages',amlang:mw.config.get('wgUserLanguage'),ammessages:allpages.join('|')});},handleMessages:function(data){window.dev=window.dev||{};dev.i18n=dev.i18n||{};dev.i18n.overrides=dev.i18n.overrides||{};dev.i18n.overrides.Discord=dev.i18n.overrides.Discord||{};if(data.query){for(var i in data.query.allmessages){var message=data.query.allmessages[i],title=message.name.slice('Custom-Discord-'.length),content=message['*'];if(message.missing==='')continue;if(title.indexOf('-')!=-1){var split=title.split('-'),key=split.pop();title=split[0];this.messages[title]=this.messages[title]||{};this.messages[title][key]=content;}else{this.messages[title]=this.messages[title]||content;dev.i18n.overrides.Discord[title]=dev.i18n.overrides.Discord[title]||content;}delete this.defaults[title];}}for(var key in this.defaults){var value=this.defaults[key];if(!this.messages[key]){if(value instanceof Error){console.error(value);return;}this.messages[key]=value;}}this.onload('messages');},
fetchWidgetData:function(id){if(this.requests[id])return this.requests[id];this.requests[id]=$.getJSON('https://discordapp.com/api/guilds/'+id+'/widget.json');return this.requests[id];},handleWidgetData:function(data){this.railWidgetData=data;this.addToRail();},mapMessages:function(){for(var key in this.messages.roles){var value=this.messages.roles[key];this.messages.roles[key]=value.match(/\d+/g);}},logo:function(){return{type:'svg',attr:{viewBox:'0 0 28 20',height:'18',width:'18'},children:[{type:'path',attr:{d:
'm20.6644 20s-0.863-1.0238-1.5822-1.9286c3.1404-0.8809 4.339-2.8333 4.339-2.8333-0.9828 0.6429-1.9178 1.0953-2.7568 1.4048-1.1986 0.5-2.3493 0.8333-3.476 1.0238-2.3014 0.4286-4.411 0.3095-6.2089-0.0238-1.36649-0.2619-2.54114-0.6429-3.52402-1.0238-0.55137-0.2143-1.15069-0.4762-1.75-0.8095-0.07192-0.0477-0.14384-0.0715-0.21575-0.1191-0.04795-0.0238-0.07192-0.0476-0.09589-0.0714-0.43151-0.2381-0.67124-0.4048-0.67124-0.4048s1.15069 1.9048 4.19521 2.8095c-0.71918 0.9048-1.60617 1.9762-1.60617 1.9762-5.29794-0.1667-7.31164-3.619-7.31164-3.619 0-7.6666 3.45205-13.8808 3.45205-13.8808 3.45206-2.5714 6.73635-2.49997 6.73635-2.49997l0.2397 0.285711c-4.31509 1.23808-6.30481 3.11902-6.30481 3.11902s0.52739-0.28572 1.41438-0.69047c2.56507-1.11904 4.60273-1.42856 5.44183-1.49999 0.1438-0.02381 0.2637-0.04762 0.4075-0.04762 1.4623-0.190471 3.1164-0.23809 4.8425-0.04762 2.2773 0.26191 4.7226 0.92857 7.2157 2.2857 0 0-1.8938-1.7857-5.9692-3.02378l0.3356-0.380948s3.2843-0.0714279 6.7363 2.49997c0 0 3.4521 6.21423 3.4521 13.8808 0 0-2.0377 3.4523-7.3356 3.619zm-11.1473-11.1189c-1.36644 0-2.4452 1.19044-2.4452 2.64284s1.10274 2.6428 2.4452 2.6428c1.36648 0 2.44518-1.1904 2.44518-2.6428 0.024-1.4524-1.0787-2.64284-2.44518-2.64284zm8.74998 0c-1.3664 0-2.4452 1.19044-2.4452 2.64284s1.1028 2.6428 2.4452 2.6428c1.3665 0 2.4452-1.1904 2.4452-2.6428s-1.0787-2.64284-2.4452-2.64284z'
,}}]};},avatar:function(member,ext,size){if(!member.avatar)return member.avatar_url;return'https://cdn.discordapp.com/avatars/'+member.id+'/'+member.avatar+'.'+ext+'?size='+size;},getRandomId:function(prefix,i){var charset='1234567890abcdef',len=charset.length;while(i--){prefix+=charset[Math.floor(Math.random()*len)];}return prefix;},buildWidget:function(data){var widget=dev.ui({children:[this.buildTitle(data),{type:'div',classes:['discord-widget-container'],attr:{id:this.getRandomId('discord-widget-',64)},style:data.size||{},children:[{type:'div',classes:['discord-widget'],children:[{type:'div',classes:['widget','widget-theme-'+(data.theme||this.messages.theme)],children:[this.buildHeader(data),this.buildBody(data),this.buildFooter(data)]}]}]}]});if(shouldPolyfillLazyLoadImages){var avatarLazyLoadIntersectionObserver=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.intersectionRatio===1){entry.target.src=entry.target.dataset.src;delete entry.target.
dataset.src;entry.target.srcset=entry.target.dataset.srcset;delete entry.target.dataset.srcset;avatarLazyLoadIntersectionObserver.unobserve(entry.target);}});},{root:widget.querySelector('.widget-body'),rootMargin:'100% 0%',threshold:1});widget.querySelectorAll('.widget-member-avatar-img').forEach(function(img){avatarLazyLoadIntersectionObserver.observe(img);});}return widget;},buildTitle:function(data){return{type:'div',classes:['title-container'],condition:data.header!='0',children:[{type:'h2',classes:['title','has-icon'],children:[this.logo(),{type:'span',html:this.i18n.msg('header',data.name).parse()}]}]};},buildHeader:function(data){return{type:'div',classes:['widget-header'],children:[{type:'a',classes:['widget-logo'],attr:{href:'https://discordapp.com/?utm_source=Discord%20Widget&utm_medium=Logo',target:'_blank'}},{type:'span',classes:['widget-header-count'],condition:data.members,html:this.i18n.msg('online',data.members&&data.members.length).parse()}]}},buildBody:function(data)
{var roles=data.members?this.groupMemberRoles(data.members):null;return{type:'div',classes:['widget-body'].concat(data.members?[]:['body-loading']),children:data.members?roles.map(this.buildRoleContainer.bind(this,data)):[]};},buildRoleContainer:function(data,role){var name=role[0],members=role[1],defaultRole=role[2];return{type:'div',classes:['widget-role-container'],attr:{'data-name':name},condition:members.length,children:[{type:'div',classes:['widget-role-name'],attr:$.extend({'data-name':name},defaultRole?{'data-default':'true'}:{}),html:name}].concat(members.map(this.buildUserChip.bind(this,data)))};},buildUserChip:function(data,member){var avatarAttrs={src:this.avatar(member,'png',32),srcset:this.avatar(member,'png',64)+' 2x'};if(canNativelyLazyLoadImages){avatarAttrs.loading='lazy';}else if(shouldPolyfillLazyLoadImages){avatarAttrs={'src':blankImgUrl,'data-src':avatarAttrs.src,'data-srcset':avatarAttrs.srcset};}return{type:'div',classes:['widget-member'],children:[{type:'div',
classes:['widget-member-avatar'],children:[{type:'img',classes:['widget-member-avatar-img'],attr:avatarAttrs},{type:'span',classes:['widget-member-status','widget-member-status-'+member.status]}]},{type:'span',classes:['widget-member-name'],text:member.nick||member.username}],events:{click:this.showMemberModal.bind(this,data,member)}};},buildFooter:function(data){return{type:'div',classes:['widget-footer'],children:[{type:'span',classes:['widget-footer-info'],html:this.i18n.msg('footer',this.messages.guidelines).parse(),condition:this.messages.guidelines||this.messages.footer},{type:'a',classes:['widget-btn-connect'],condition:data.invite||this.messages.invite||data.instant_invite,attr:{href:data.invite||this.messages.invite||data.instant_invite,target:'_blank'},html:this.i18n.msg('join').parse()}]};},groupMemberRoles:function(members){var grouped=[],indices={},defaultRole=this.i18n.msg('users').plain(),roles=Object.keys(this.messages.roles);members.sort(function(a,b){return(a.nick||a.
username).localeCompare(b.nick||b.username);});if(this.messages.order){var order=this.messages.order.split(',').map(function(name){return name.trim();});roles.sort(function(a,b){var aIndex=order.indexOf(a);if(aIndex==-1)return 1;var bIndex=order.indexOf(b);if(bIndex==-1)return-1;return aIndex-bIndex;});}for(var i in roles){var role=roles[i];indices[role]=grouped.push([role,[]])-1;}indices[defaultRole]=grouped.push([defaultRole,[],true])-1;for(var i in members){var member=members[i],assigned=!1;for(var role in this.messages.roles){var ids=this.messages.roles[role];if(ids.includes(member.id)){grouped[indices[role]][1].push(member);assigned=!0;break;}}if(!assigned){grouped[indices[defaultRole]][1].push(member);}}return grouped;},showMemberModal:function(data,member){var game=member.game||{};$.showCustomModal(member.nick||member.username,dev.ui({type:'div',classes:['discord-member-modal-content'],children:[{type:'div',classes:['avatar-container','loading'],children:[{type:'a',classes:
['avatar-link'],attr:{href:this.avatar(member,'png',2048),target:'_blank'},children:[{type:'img',classes:['avatar'],attr:{src:this.avatar(member,'png',256)},events:{load:function(){this.parentElement.parentElement.classList.remove('loading');}}}]}]},{type:'div',classes:['details'],children:[{type:'div',classes:['username'],children:[{type:'span',classes:['name'],text:member.username},{type:'span',classes:['discriminator'],text:'#'+member.discriminator}]},{type:'div',classes:['playing'],html:this.i18n.msg(game.name=='Spotify'?'listening':'playing',game.name).parse(),condition:game.name}]}]}),{id:'discord-member-modal',width:'invalid so that the CSS can take over lol',callback:function($modal){$modal.addClass('discord-member-modal-theme-'+(data.theme||this.messages.theme));}.bind(this)});},addToRail:function(data){if(!this.$rail.exists())return;$('.discord-module').remove();if(!this.railWidgetData){this.fetchWidgetData(this.messages.id).then(this.handleWidgetData.bind(this));}var widget=
this.buildWidget(this.railWidgetData||{}),railModule=dev.ui({type:'section',classes:['rail-module','discord-module'],attr:{'data-widget-state':'loading'},children:[widget]}),$ads=$('#top-right-boxad-wrapper, #NATIVE_TABOOLA_RAIL').last(),$jsrt=$('.content-review-module');if($ads.exists()){$ads.after(railModule);}else if($jsrt.exists()){$jsrt.after(railModule);}else{this.$rail.prepend(railModule);}this.onRenderedWidget(railModule);mw.hook('Discord.widget.rail').fire(railModule);},replaceWidget:function(_,elem){elem.dataset.widgetState='loading';var id=elem.getAttribute('data-id')||this.messages.id,theme=elem.getAttribute('data-theme')||this.messages.theme,width=elem.getAttribute('data-width'),height=elem.getAttribute('data-height'),invite=elem.getAttribute('data-invite'),header=elem.getAttribute('data-header');if(!id)return;this.fetchWidgetData(id).then(function(data){data.theme=theme;data.size={};if(width){data.size.width=width;}if(height){data.size.height=height;}if(invite){data.
invite=invite;}else{data.invite=data.instant_invite;}if(header){data.header=header;}var widget=this.buildWidget(data);$(elem).empty().append(widget);this.onRenderedWidget(elem);}.bind(this));},onRenderedWidget:function(widget){var container=widget.querySelector('.discord-widget-container'),discord=container.querySelector('.discord-widget'),body=discord.querySelector('.widget-body'),largest=Array.from(body.children).sort(this.sortRoleContainers.bind(this))[0];if(!largest)return;var members=largest.querySelectorAll('.widget-member'),initial=members[0].offsetTop,count=0;for(var i=0;i<members.length;i++){if(members[i].offsetTop>initial)break;count++;}discord.classList.add('resolved-columns');this.addCSS(this.createNameDirectionStyles(count,container.id));widget.dataset.widgetState='loaded';mw.hook('Discord.widget').fire(widget);},sortRoleContainers:function(a,b){return b.children.length-a.children.length;},addCSS:function(styles){mw.util.addCSS(styles);},createNameDirectionStyles:function(
count,id){var half=Math.floor(count/2),i=half,selectors=[];while(i--){selectors.push(this.createDirectionSelector(count,id,i-half+2));}return selectors.join(',\n')+'{\n\tpadding: 0 32px 0 8px;\n\tright: 4px;\n}';},createDirectionSelector:function(count,id,half){var n=half==0?'':half>0?'+'+half:'-'+Math.abs(half);return'#'+id+' .widget-member:nth-child('+count+'n'+n+') .widget-member-name';},replaceWidgets:function($container){$container.find('.DiscordWidget:not([data-widget-state])').each(this.replaceWidget.bind(this));},getHeight:function(elem){var style=getComputedStyle(elem);return elem.clientHeight+parseInt(style.marginTop)+parseInt(style.marginBottom);},reflow:function(elem,columns,force){if(this.reflowing){this.reflowing=!1;if(!force){return;}}this.reflowing=!0;var full=0,sum=0,overhead=5,children=elem.children,i=children.length;elem.style.maxHeight='';if(innerWidth>1023)return;while(i--){full+=this.getHeight(children[i]);}var partition=full/columns;for(var i=0;i<children.
length;i++){sum+=this.getHeight(children[i]);if(sum>partition){break;}}elem.style.maxHeight=(sum+overhead)+'px';},patchStupidRail:function(){if(!this.$rail||!window.MutationObserver||navigator.maxTouchPoints===0)return;var rail=this.$rail.get(0);rail.parentElement.style.columnCount='auto';rail.style.display='flex';rail.style.flexDirection='column';rail.style.flexWrap='wrap';this.reflow(rail,2,true);new MutationObserver(this.reflow.bind(this,rail,2,false)).observe(rail,{childList:!0,subtree:!0,attributes:!0});},init:function(){this.mapMessages();if(this.messages.id){this.addToRail();}this.replaceWidgets(mw.util.$content);mw.hook('wikipage.content').add(this.replaceWidgets.bind(this));this.patchStupidRail();}},window.Discord);if(!Discord.$rail.exists()||Discord.$rail.hasClass('loaded')){Discord.onload();}else{Discord.$rail.on('afterLoad.rail',Discord.onload.bind(Discord));}mw.hook('dev.ui').add(Discord.onload.bind(Discord));mw.hook('dev.i18n').add(Discord.onload.bind(Discord,'i18n'
));mw.loader.using('mediawiki.api').then(Discord.onload.bind(Discord,'api'));importArticles({type:'script',articles:['u:dev:MediaWiki:I18n-js/code.js','u:dev:MediaWiki:UI-js/code.js']});var style=importArticle({type:'style',article:'u:dev:MediaWiki:Discord.css'})[0];if(style){style.onload=Discord.onload.bind(Discord);}else{Discord.onload();}})();;require(['jquery','mw','BannerNotification','wikia.window'],function($,mw,BannerNotification,window){var config=mw.config.get(['wgAction','wgArticleId','wgNamespaceIds','wgNamespaceNumber','wgPageName','wgContentLanguage','wguserName','stylepath','wgScriptPath']);if(!(config.wgAction==='edit'||config.wgAction==='submit')||{1201:1,1200:1,2002:1}[config.wgNamespaceNumber]||config.wgArticleId===0||window.EditConflictAlertInit){return;}window.EditConflictAlertInit=!0;mw.loader.using('mediawiki.api').then(function(){var Api=new mw.Api(),help=Object.keys(config.wgNamespaceIds).filter(function(id){return config.wgNamespaceIds[id]===12;})[0].replace
(/\b./g,function(char){return char.toUpperCase();}),cur_id,old_id,diff,content,i18n;if(!window.dev||!window.dev.i18n){importArticle({type:'script',article:'u:dev:MediaWiki:I18n-js/code.js'});}function fetch_revs(with_content){return Api.get({action:'query',prop:'revisions',rvprop:'ids|user'+(with_content?'|content':''),titles:config.wgPageName,cb:Date.now()});}function load_diff(){$.get(config.wgScriptPath+'/?diffonly=1&diff='+cur_id+'&oldid='+old_id,function(page){var $el=$(page).find('.diff');diff=$('<div>').append($el.clone()).html();$('#ajax-indicator').replaceWith(diff);});}function add_content(){$('#diff-modal').closeModal();$('.banner-notification .close').click();$('#diff, #myedit').remove();$('[name="wpStarttime"]').val(new Date().toISOString().replace(/\D/g,'').slice(0,-3));var $edit_area=$('#wpTextbox1'),your_text=$edit_area.val(),$diff=$('<div>',{id:'diff'}).append($('<h2>',{append:$('<span>',{class:'mw-headline',id:'The_differences_.28help.29',append:[i18n.msg(
'the-differences').escape(),' (',$('<a>',{target:'_blank',href:config.wgScriptPath+'/wiki/'+help+':Diff',title:help+':Diff',text:i18n.msg('help').plain()}),')']})}),$(diff)),$myedit=$('<div>',{id:'myedit'}).append($('<h2>',{append:$('<span>',{class:'mw-headline',id:'myedit-header',text:i18n.msg('your-edit').plain()})}),$('<textarea>',{id:'wpTextbox2',name:'wpTextbox2',tabindex:6,readonly:!0,accesskey:',',cols:80,rows:25,lang:config.wgContentLanguage,dir:document.documentElement.dir,val:your_text}));$edit_area.val(content);$('.mw-editTools').after($diff,$myedit);}function add_ace_content(){$('#diff-modal').closeModal();$('.banner-notification .close').click();$('#diff, #myedit').remove();$('[name="wpStarttime"]').val(new Date().toISOString().replace(/\D/g,'').slice(0,-3));var $edit_area=$('#wpTextbox1'),your_text=$edit_area.val(),$diff=$('<div>',{id:'diff'}).append($('<h2>',{append:$('<span>',{class:'mw-headline',id:'The_differences_.28help.29',append:[i18n.msg('the-differences').
escape(),' (',$('<a>',{target:'_blank',href:config.wgScriptPath+'/wiki/'+help+':Diff',title:help+':Diff',text:i18n.msg('help').plain()}),')']})}),$(diff)),$myedit=$('<div>',{id:'myedit'}).append($('<h2>',{append:$('<span>',{class:'mw-headline',id:'myedit-header',text:i18n.msg('their-edit').plain()})}),$('<textarea>',{id:'wpTextbox2',name:'wpTextbox2',tabindex:6,readonly:!0,accesskey:',',cols:80,rows:25,lang:config.wgContentLanguage,dir:document.documentElement.dir,val:content}));$('.mw-editTools').after($diff,$myedit);}function show_diff_modal(){$.showCustomModal(i18n.msg('diff-between-revs').escape(),$('<img>').attr({id:'ajax-indicator',src:config.stylepath+'/common/images/ajax.gif',title:i18n.msg('loading').plain(),alt:i18n.msg('loading').plain()}).css({float:'center',margin:'2em auto',display:'block'}),{width:Math.min(window.innerWidth-200,1000),id:'diff-modal',callback:load_diff,buttons:[{message:i18n.msg('close').escape(),handler:function(){$('#diff-modal').closeModal();}},{
defaultButton:!0,message:i18n.msg('update').escape(),handler:window.ace?add_ace_content:add_content}]});}function init(){fetch_revs(false).done(function(data){var d=data.query.pages;old_id=cur_id=d[Object.keys(d)[0]].revisions[0].revid;});setInterval(function(){fetch_revs(true).done(function(data){var d=data.query.pages,p=d[Object.keys(d)[0]];if(!p.revisions){return;}var r=p.revisions[0];content=r['*'];if(r.revid!==cur_id&&r.user!==config.wgUserName){if($('.banner-notifications-wrapper[data-id="'+r.revid+'"]').length)return;if($('#diff-modal').length){$('#diff-modal').closeModal();}$('.banner-notifications-wrapper').remove();cur_id=r.revid;var message=i18n.msg('notification-body').escape()+' (<a id="view-diff" href="#">'+i18n.msg('diff').escape()+'</a>)';new BannerNotification(message,'notify',$('.banner-notifications-placeholder')).show().$element.parent().attr('data-id',cur_id);$('#view-diff').click(function(e){e.preventDefault();show_diff_modal();});}});},window.
EditConflictAlertInterval||window.queryInterval||5000);}mw.hook('dev.i18n').add(function(lib){lib.loadMessages('EditConflictAlert').done(function(lang){i18n=lang;i18n.useUserLang();init();});});if($('.banner-notifications-placeholder').length){return;}$('.wds-global-navigation-wrapper').after($('<div>',{class:'banner-notifications-placeholder',append:$('<div>',{class:'banner-notifications-wrapper float'}).css('top',56)}).css({height:0,position:'absolute',left:0,right:0}));});});;require(['wikia.window','jquery','mw','wikia.tracker'],function(window,$,mw,tracker){var config={player:'VXc5h4Tf',langs:{en:{header:'New to editing and contributing? We have an <a href="https://community.fandom.com/wiki/Fandom_University" title="Fandom University">extensive video library</a> to help you learn how to edit.',playlist:'g0INIi6n'},es:{header:
'¿Estás empezando a editar y contribuir? Tenemos una <a href="https://comunidad.fandom.com/wiki/Universidad_de_FANDOM" title="Universidad de FANDOM">extensa videoteca</a> para ayudarte a aprender.',playlist:'XdgYjVRp?related_media_id=sxyvaxtY'}}},track=tracker.buildTrackingFunction({category:'fandomu-module',action:tracker.ACTIONS.CLICK,trackingMethod:'analytics'});function videoPlaylistModule(){if($('#community-page-player').length){return;}importArticle({type:'style',article:'u:dev:MediaWiki:FandomU.css'});var lang=mw.config.get('wgUserLanguage');lang=config.langs.hasOwnProperty(lang)?lang:'en';var $header=$('<div>',{class:'community-page-cards-module-header'}).html(config.langs[lang].header),$playerWrapper=$('<div>',{class:'community-page-todo-list-module'}),$player=$('<div>',{id:'community-page-player'}),$playlistWrapper=$('<div>',{class:'community-page-module'}),$playlist=$('<div>',{id:'community-page-player-list'});$('<div>',{class:
'CommunityPageMainContent CommunityPageFandomU'}).append($header,$playerWrapper.append($player),$('<div>',{class:'community-page-rail'}).append($playlistWrapper.append($playlist))).prependTo('.CommunityPageContainer');function resize(){$playlist.css('max-height',$player.height());var headerPaddingLeft=parseInt($playerWrapper.css('margin-left'));$header.css({'padding-left':headerPaddingLeft,'padding-right':$header.outerWidth()-($playlistWrapper[0].offsetLeft-$player[0].offsetLeft+$playlistWrapper.width())-headerPaddingLeft});}$(window).on('resize',resize);$.getScript('//content.jwplatform.com/libraries/'+config.player+'.js').then(function(){jwplayer('community-page-player').setup({autostart:!1,playlist:'//cdn.jwplayer.com/v2/playlists/'+config.langs[lang].playlist,pid:config.player,width:'100%'}).on('ready',function(){$player=$('#community-page-player');var player=this;player.getPlaylist().forEach(function(e){$('<img>',{class:'community-page-player-list-item',src:e.image,width:
'calc( 100% - 3px )'}).click(function(){player.playlistItem($(this).index());}).appendTo($playlist);});track({action:tracker.ACTIONS.FLOW_START,label:'jwplayer-ready'});resize();}).on('viewable',function(){resize();}).on('playlistItem',function(e){$playlist.children('.active').removeClass('active');$playlist.children().eq(e.index).addClass('active');track({action:tracker.ACTIONS.SELECT,label:'playlistitem',value:e.index});}).on('firstFrame',function(){track({action:tracker.ACTIONS.PLAY_VIDEO,label:'play',value:this.getPlaylistIndex()});}).on('complete',function(){track({action:tracker.ACTIONS.PLAY_VIDEO,label:'complete',value:this.getPlaylistIndex()});});});}if(mw.config.get('wgCanonicalSpecialPageName')==='Community'){videoPlaylistModule();}});;require(['wikia.window','jquery','mw','wikia.loader','wikia.mustache','wikia.throbber','wikia.ui.factory'],function(window,$,mw,loader,mustache,throbber,uiFactory){if(window.CommunityFocusModulesLoaded){return;}window.
CommunityFocusModulesLoaded=!0;var api,config=mw.config.get(['wgCanonicalSpecialPageName','wgFormattedNamespaces','wgNamespaceIds']),nsCategoryPrefix=config.wgFormattedNamespaces[config.wgNamespaceIds.category]+':',nsSpecialPrefix=config.wgFormattedNamespaces[config.wgNamespaceIds.special]+':';function communityPageModule(id,options){return new $.Deferred(function(deferred){require(['communitypage.templates.mustache'],function(templates){deferred.resolve($(mustache.render(templates.cardModule,options)).attr('id',id.replace(/\W+/g,'_')));});});}function FocusCategory(data){this.title=data.title;this.cardTitle=data.cardTitle||data.title;this.cardDescription=data.cardDescription;this.focusArticle=data.focusArticle;this.railDescription=data.railDescription||'We need more $1 info!';this.railButton=data.railButton||'Help add it';this.modal=null;this.members=null;}FocusCategory.prototype.getUrl=function(){return mw.util.getUrl(this.title);};FocusCategory.prototype.getMembers=function(
gcmcontinue){var self=this;function internalGetMembers(deferred){if(self.members&&!gcmcontinue){deferred.resolve(self.members);}api.get({action:'query',prop:'revisions',generator:'categorymembers',rvprop:'timestamp',gcmtitle:nsCategoryPrefix+self.title,gcmtype:'page',gcmlimit:'max',gcmcontinue:gcmcontinue,list:'categorymembers',cmtitle:nsCategoryPrefix+self.title,cmtype:'subcat',cmprop:'title',cmlimit:'max'}).done(function(r,s){if(s!=='success'||!r.query){deferred.resolve([]);return;}var out=[];if(r.query.pages){Object.values(r.query.pages).forEach(function(e){var date=new Date(e.revisions[0].timestamp);out.push({id:e.pageid,link:{editlink:mw.util.getUrl(e.title),text:e.title},timestamp:date.getTime(),timeAgo:$.timeago(date),exists:!0});});}$.when(new $.Deferred(function(deferred){if(r['query-continue']){self.getMembers(r['query-continue'].categorymembers.gcmcontinue).done(function(members){out=out.concat(members);deferred.resolve();});}else{deferred.resolve();}}),new $.Deferred(
function(deferred){subdeferreds=[];r.query.categorymembers.forEach(function(e){subdeferreds.push(new FocusCategory({title:e.title.replace(nsCategoryPrefix,'')}).getMembers().done(function(members){out=out.concat(members);}));});$.when.apply(undefined,subdeferreds).done(deferred.resolve);})).done(function(){self.members=out.sort(function(a,b){return a.timestamp-b.timestamp;}).filter(function(e,i,a){return i+1==a.length||e.id!==a[i+1].id;});deferred.resolve(self.members);});});}if(gcmcontinue){return new $.Deferred(internalGetMembers);}if(!self.__getMembersDeferred){self.__getMembersDeferred=new $.Deferred(internalGetMembers).done(function(){self.__getMembersDeferred=undefined;});}return self.__getMembersDeferred;};FocusCategory.prototype.getFeaturedMembers=function(){var self=this;return new $.Deferred(function(deferred){self.getMembers().done(function(members){deferred.resolve(members.slice(0,3));});});};FocusCategory.prototype.createCommunityPageCard=function(modal){var self=this;
function internalCreateCommunityPageCard(fmembers){if((!fmembers||!fmembers.length)&&!self.cardDescription){return;}communityPageModule('focus-'+self.title,{title:self.cardTitle,icon:'other',pages:fmembers,description:self.cardDescription,fulllistlink:self.getUrl(),cardModules:{messages:{fulllist:mw.message('communitypage-full-list').plain()}}}).done(function($module){$module.appendTo('.community-page-cards-module-block');var $fulllist=$module.find('a.community-page-card-module-full-list-link');if(modal){$fulllist.on('click',$.proxy(self.triggerFocusModal,self,'modal-from-card'));}else{$fulllist.on('click',function(e){ga('send','event',{eventCategory:'focus-module',eventAction:'from-maintenance-card',eventLabel:e.target.href,transport:'beacon'});});}$module.find('.community-page-card-module-article-data > a').on('click',function(e){ga('send','event',{eventCategory:'focus-module',eventAction:'article-link-from-card',eventLabel:e.target.href,transport:'beacon'});});});}if(self.
cardDescription){internalCreateCommunityPageCard();}else{self.getFeaturedMembers().done(internalCreateCommunityPageCard);}};FocusCategory.prototype.createRailModule=function(){var self=this,fakemsg=new mw.Map();fakemsg.set('d',self.railDescription);$('.community-page-rail-module').append($('<div>',{class:'content',id:'focus-widget-'+self.title.replace(/\W+/g,'_')}).append($('<div>',{class:'description',html:new mw.Message(fakemsg,'d',['<a href="'+self.getUrl()+'">'+self.cardTitle+'</a>']).parse()}),$('<a>',{class:'wds-button wds-is-secondary',href:mw.util.getUrl('Special:Community')+'#focus-'+self.title.replace(/\W+/g,'_'),text:self.railButton}).on('click',$.proxy(self.triggerFocusModal,self,'rail-module-cta-button'))));};FocusCategory.prototype.getFocusArticleData=function(){var self=this;return new $.Deferred(function(deferred){var out={subtitle:'',sections:[]};if(!self.focusArticle){deferred.resolve(out);return;}api.get({action:'parse',page:self.focusArticle,props:['sections','text'
]}).done(function(r,s){if(s!=='success'||!r.parse){deferred.resolve(out);return;}var subtitle=r.parse.text['*'].match(/<p [^>]*id="focus-modal-subtitle"[^>]*>(.*?)<\/p>/);if(subtitle&&subtitle[1]){out.subtitle=subtitle[1];}var subdeferreds=[];r.parse.sections.forEach(function(e){subdeferreds.push(new $.Deferred(function(subdeferred){$.when(api.get({action:'parse',page:self.focusArticle,props:'links',section:e.number}),self.getMembers()).done(function(r2,members){if(r2[1]!=='success'||!r2[0].parse){subdeferred.resolve();return;}var pages=[],missingdates={},lastedited=!1;r2[0].parse.links.forEach(function(e){if(e.hasOwnProperty('exists')){var m=members.find(function(e2){return e['*']===e2.link.text;});lastedited=!0;if(m){pages.push(m);return;}else{missingdates[e['*']]=pages.length;}}pages.push({link:{editlink:mw.util.getUrl(e['*']),text:e['*']},exists:e.hasOwnProperty('exists'),timestamp:undefined,timeAgo:undefined,});});new $.Deferred(function(subsubdeferred){var missingdatesKeys=
Object.keys(missingdates);if(!missingdatesKeys.length){subsubdeferred.resolve();return;}api.get({action:'query',prop:'revisions',rvprop:'timestamp',titles:missingdatesKeys.join('|')}).done(function(r3,s3){if(s3==='success'&&r3.query){Object.values(r3.query.pages).forEach(function(e){var date=new Date(e.revisions[0].timestamp),entry=pages[missingdates[e.title]];entry.timestamp=date.getTime();entry.timeAgo=$.timeago(date);});}subsubdeferred.resolve();});}).done(function(){if(pages.length){pages.sort(function(a,b){if(a.exists&&!b.exists){return 1;}if(!a.exists&&b.exists){return-1;}return a.timestamp-b.timestamp;});out.sections[e.number]={id:e.anchor,title:e.line,count:pages.length,items:pages,lastedited:lastedited};}subdeferred.resolve();});})}));});$.when.apply(undefined,subdeferreds).then(function(){deferred.resolve(out);});});});};FocusCategory.prototype.triggerFocusModal=function(a,e){e.preventDefault();ga('send','event',{eventCategory:'focus-module',eventAction:a,eventLabel:
nsCategoryPrefix+this.title});if(!this.modal){this.createFocusModal();}else{$(document.body).append(this.modal.$blackout);this.showFocusModal();}}
FocusCategory.prototype.createFocusModal=function(){var self=this;$.when(new $.Deferred(function(deferred){uiFactory.init('modal').done(function(uiModal){uiModal.createComponent({vars:{id:'focus-modal-'+self.title.replace(/\W+/g,'_'),classes:['CommunityPageModalDialog'],content:'<div class="throbber-placeholder"></div>',title:self.cardTitle,size:'medium'}},function(modal){throbber.show($('.throbber-placeholder'));modal.show();deferred.resolve(modal);});})}),self.getMembers(),self.getFocusArticleData(),loader({type:loader.SCSS,resources:['/extensions/wikia/CommunityPage/styles/components/_contributors-module.scss','/extensions/wikia/CommunityPage/styles/components/_modal.scss']})).done(function(modal,pages,data){self.modal=modal;data.sections.unshift({id:'all',title:'All',count:pages.length,items:pages,active:!0,lastedited:!0});var $header=self.modal.$element.children('header');$header.html(mustache.render('<h3>{{title}}</h3>{{{subtitle}}}'+'<ul class="reset modal-nav">'+'{{#tabs}}'
+'<li>'+'<a class="modal-tab-link{{#active}} active{{/active}}" data-tabtoggle="{{id}}" href="#">{{title}} {{#count}}<span id="allCount">({{count}})</span>{{/count}}</a>'+'</li>'+'{{/tabs}}'+'</ul>',{title:self.cardTitle,subtitle:data.subtitle,tabs:data.sections}),true).prepend(self.modal.$close);self.modal.$content.html(mustache.render('{{#tabs}}'+'<div class="contributors-module contributors-module-modal" data-tabid="{{id}}"{{^active}} style="display:none"{{/active}}>'+'{{#lastedited}}<div class="community-page-all-contributors-legend">'+mw.message('listusers-edited').escaped()+'</div>{{/lastedited}}'+'<ul class="reset top-contributors">'+'{{#items}}'+'<li class="community-page-contributors-list-item">'+'<a class="community-page-contributor-details{{^exists}} new{{/exists}}" href="{{link.editlink}}">{{link.text}}</a>'+'{{#timeAgo}}<div class="community-page-details">{{timeAgo}}</div>{{/timeAgo}}'+'</li>'+'{{/items}}'+'</ul>'+'</div>'+'{{/tabs}}',{tabs:data.sections}));self.
showFocusModal();});};FocusCategory.prototype.showFocusModal=function(){var self=this;self.modal.$content.addClass('contributors-module contributors-module-modal');self.modal.$element.find('.modal-tab-link').on('click',function(){var $this=$(this);if($this.hasClass('active')){return;}var tab=self.modal.$element.find('.modal-tab-link.active').removeClass('active').data('tabtoggle');self.modal.$content.find('.contributors-module[data-tabid="'+tab+'"]').css('display','none');$this.addClass('active');self.modal.$content.find('.contributors-module[data-tabid="'+$this.data('tabtoggle')+'"]').css('display','');});self.modal.$content.find('.community-page-contributor-details').on('click',function(e){ga('send','event',{eventCategory:'focus-module',eventAction:'article-link-from-modal',eventLabel:e.target.href,transport:'beacon'});});self.modal.show();};function FocusQuerypage(data){FocusCategory.call(this,data);}FocusQuerypage.prototype=Object.create(FocusCategory.prototype);FocusQuerypage.
prototype.getUrl=function(){return mw.util.getUrl(nsSpecialPrefix+this.title);}
FocusQuerypage.prototype.getMembers=function(){var self=this;return new $.Deferred(function(deferred){if(self.members){deferred.resolve(self.members);}api.get({action:'query',list:'querypage',qppage:self.title,qplimit:3}).done(function(r,s){if(s!=='success'||!r.query||!r.query.querypage){deferred.resolve([]);return;}self.members=[];r.query.querypage.results.forEach(function(e){self.members.push({link:{editlink:mw.util.getUrl(e.title),text:e.title},exists:!0});});deferred.resolve(self.members);});});}
function focusModules(){api=new mw.Api();api.get({action:'query',meta:'allmessages',ammessages:'Custom-Focus|Custom-Maintenance|communitypage-full-list|listusers-edited'}).done(function(r,s){if(s!=='success'||!r.query){return;}mw.messages.set({'communitypage-full-list':r.query.allmessages[2]['*'],'listusers-edited':r.query.allmessages[3]['*']});if(r.query.allmessages[0]['*']){var categories={},lines=r.query.allmessages[0]['*'].split('\n');for(var i=0;i<lines.length;++i){var e=lines[i];if(e.startsWith('*')){var category={title:e.replace(/^\*\s*/,'')};for(++i;i<lines.length&&lines[i].startsWith('**');++i){var line=lines[i].replace(/^\*\*\s*/,'').split('|');if(line.length>=2){category[line.shift().trim()]=line.join('|').trim();}}if(i<lines.length-1){--i;}categories[nsCategoryPrefix+category.title]=new FocusCategory(category);}else{var line=e.split('|');if(line.length!==2&&line.length!==3){continue;}line[0]=line[0].trim();categories[nsCategoryPrefix+line[0]]=new FocusCategory({title:line[0
],cardTitle:line[1]?line[1].trim():undefined,focusArticle:line[2]?line[2].trim():undefined});}}var $wikiaRail=$('#WikiaRail');api.get({action:'query',prop:'categoryinfo',titles:Object.keys(categories).join('|')}).done(function(r,s){if(s!=='success'||!r.query){return;}Object.values(r.query.pages).forEach(function(e){if(e.hasOwnProperty('categoryinfo')){var categoryTitle=e.title;if(r.query.normalized){var normalized=r.query.normalized.find(function(e2){return e2.to===e.title;});if(normalized){categoryTitle=normalized.from;}}var category=categories[categoryTitle];if(config.wgCanonicalSpecialPageName==='Community'){category.createCommunityPageCard(true);}else{if($wikiaRail.length){if($wikiaRail.hasClass('loaded')){category.createRailModule();}else{$wikiaRail.on('afterLoad.rail',$.proxy(category.createRailModule,category));}}}}});});}if(r.query.allmessages[1]['*']&&config.wgCanonicalSpecialPageName==='Community'){var categories2={},querypages=[],lines=r.query.allmessages[1]['*'].split('\n')
,categoryRegExp=new RegExp('^(?:'+nsCategoryPrefix+'|Category):'),querypageRegExp=new RegExp('^(?:'+nsSpecialPrefix+'|Special):');for(var i=0;i<lines.length;++i){var e=lines[i];var line=e.split('|');if(line.length!==2&&line.length!==3){continue;}line[0]=line[0].trim();if(categoryRegExp.test(line[0])){categories2[line[0]]=new FocusCategory({title:line[0].replace(categoryRegExp,''),cardTitle:line[1]?line[1].trim():undefined,cardDescription:line[2]?line[2].trim():undefined});}else if(querypageRegExp.test(line[0])){querypages.push(new FocusQuerypage({title:line[0].replace(querypageRegExp,''),cardTitle:line[1]?line[1].trim():undefined,cardDescription:line[2]?line[2].trim():undefined}));}}categories2Keys=Object.keys(categories2);if(categories2Keys.length){api.get({action:'query',prop:'categoryinfo',titles:categories2Keys.join('|')}).done(function(r,s){if(s!=='success'||!r.query){return;}Object.values(r.query.pages).forEach(function(e){if(e.hasOwnProperty('categoryinfo')){var categoryTitle=e.
title;if(r.query.normalized){var normalized=r.query.normalized.find(function(e2){return e2.to===e.title;});if(normalized){categoryTitle=normalized.from;}}categories2[categoryTitle].createCommunityPageCard();}});});}querypages.forEach(function(e){e.createCommunityPageCard();});}});}mw.loader.using(['mediawiki.api','mediawiki.util']).done(focusModules);});;require([require.optional('ext.wikia.design-system.loading-spinner'),'jquery','mw',require.optional('wikia.tracker'),'wikia.window'],function(Spinner,$,mw,tracker,window){if(window.helpPanelLoaded){return;}window.helpPanelLoaded=!0;var HelpPanel={config:mw.config.get(['wgIsEditPage','wgSassParams','wgSiteName','wgUserId','wgUserName']),helpPages:['general-editing-help','infoboxes','adding-images','adding-links','source-editor'],loading:3,preload:function(){if(--this.loading===0){window.dev.i18n.loadMessages('u:dev:MediaWiki:Custom-InEditorHelp/i18n.json').then($.proxy(this.init,this));}},isNewUser:function(){var self=this;return new $
.Deferred(function(deferred){if(self.config.wgUserId===null){deferred.resolve(true);return;}var cache=localStorage.getItem('HelpPanel-newUser');if(cache===false||(cache!==null&&Date.now()-parseInt(cache)<900000)){deferred.resolve(cache!==false);return;}new mw.Api().get({action:'query',meta:'userinfo',uiprop:'editcount'}).done(function(r){var newUser=r.error||r.query.userinfo.editcount<25;deferred.resolve(newUser);localStorage.setItem('HelpPanel-newUser',newUser?Date.now():false);});});},init:function(i18n){this.i18n=i18n;this.addCSS();this.addTracking();this.ipPromise=this.config.wgUserName?$.Deferred().resolve():this.fetchIP();var self=this;this.isNewUser().done(function(newUser){if(!newUser)return;if(self.config.wgIsEditPage){self.initEditor();}else{mw.hook('ve.activationComplete').add($.proxy(self.initEditor,self));mw.hook('ve.deactivationComplete').add($.proxy(self.destroyVisualEditor,self));}});},addCSS:function(){var background=$('#EditPage').css('background-color');if(!$(
'#EditPage').exists()){background=$('.WikiaPage .WikiaPageBackground').css('background-color');}mw.util.addCSS('html {'+'--helpPanel-bgcolor:'+background+';'+'--helpPanel-header-bgcolor:'+this.config.wgSassParams['color-header']+';'+'}');},fetchIP:function(){return $.get(mw.util.wikiScript('api'),{action:'query',meta:'userinfo',format:'json'});},togglePanelOpen:function(){$('#helpPanelCTA').hide();$('#helpPanel').toggleClass('hideHelpPanel').toggleClass('showHelpPanel');},togglePanelClose:function(){$('#helpPanel').toggleClass('hideHelpPanel').toggleClass('showHelpPanel');$('#helpPanelCTA').show();},closeNotification:function(){$('#helpPanelCTA').hide();},submitPost:function(){if($('#hp-forum-textarea').val()===''){$('#helpPanel-forum .error-msg').css('display','block');return;}$.ajax({type:'POST',url:'https://'+this.i18n.msg('community-wiki-url').plain()+'/wikia.php?'+$.param({controller:'WallExternal',method:'postNewMessage',format:'jsonp'}),data:{body:$('#hp-forum-textarea').val()+(
$('#helpPanel-check').attr('checked')==='checked'?('\n\n\n'+new mw.Uri(mw.util.getUrl()).toString()):''),messagetitle:$('#helpPanel-check').attr('checked')=='checked'?this.i18n.msg('need-help-on',this.config.wgSiteName).plain():this.i18n.msg('need-help').plain(),pagenamespace:2000,pagetitle:this.i18n.msg('forum-board').plain(),token:mw.user.tokens.get('editToken')},xhrFields:{withCredentials:!0},complete:$.proxy(this.checkPost,this)});$('#helpPanel-spinner').addClass('show');$('#helpPanel-forum .error-msg').css('display','none');},checkPost:function(){$.ajax({type:'GET',url:'https://'+this.i18n.msg('community-wiki-url').plain()+'/api.php',data:{action:'query',list:'usercontribs',ucuser:this.config.wgUserName||this.ip,ucnamespace:2001,ucprop:'ids',uclimit:1,format:'json'},dataType:'jsonp',success:$.proxy(this.submittedPost,this),error:$.proxy(this.submittedFail,this)});},submittedPost:function(data){if(data.query.usercontribs.length===0||new Date(data.query.usercontribs[0].timestamp)<
new Date()-60*60*1000){return this.submittedFail(data);}$('#helpPanel-post-link').attr('href','https://'+this.i18n.msg('community-wiki-url').plain()+'/wiki/Thread:'+data.query.usercontribs[0].pageid);$('#helpPanel-spinner').removeClass('show');$('#hp-step3').addClass('showHP-step').removeClass('hideHP-step');$('#hp-step1, #hp-step2').addClass('hideHP-step').removeClass('showHP-step');},submittedFail:function(data){console.error(data);},toggleStep1:function(){$('#hp-step1').addClass('showHP-step').removeClass('hideHP-step');$('#hp-step2, #hp-step3').addClass('hideHP-step').removeClass('showHP-step');},toggleStep2:function(){$('#hp-step2').addClass('showHP-step').removeClass('hideHP-step');$('#hp-step1, #hp-step3').addClass('hideHP-step').removeClass('showHP-step');},done:function(){$('#hp-forum-textarea').val('');this.toggleStep1();},waitForIP:function(){this.ipPromise.then($.proxy(this.gotIP,this));},gotIP:function(data){if(this.config.wgUserName){$('#helpPanel-post-text').html(this.
i18n.msg('ask-intro',this.i18n.msg('username').plain(),this.config.wgUserName).parse());}else{this.ip=data.query.userinfo.name;$('#helpPanel-post-text').html(this.i18n.msg('ask-intro',this.i18n.msg('ip').plain(),this.ip).parse());}$('#hp-step2').addClass('showHP-step').removeClass('hideHP-step');$('#hp-step1, #hp-step3').addClass('hideHP-step').removeClass('showHP-step');},initEditor:function(){if(!$('#WikiaNotifications').exists()){var notifications=window.dev.ui({type:'ul',attr:{id:'WikiaNotifications'},classes:['WikiaNotifications']});if($('#WikiaBar').exists()){$('#WikiaBar').append(notifications);}else{$(document.body).append(notifications);}}$('#WikiaNotifications').append(window.dev.ui({type:'li',children:[{type:'div',attr:{id:'helpPanelCTA',},children:[{type:'p',text:this.i18n.msg('get-help').plain(),events:{click:$.proxy(this.togglePanelOpen,this)},},{type:'a',classes:['sprite','close-notification'],events:{click:$.proxy(this.closeNotification,this)},data:{tracking:'CTA-close'
}}]}]}),window.dev.ui({type:'div',attr:{id:'helpPanel',},classes:['hideHelpPanel'],children:[{type:'div',attr:{id:'helpPanel-spinner'},html:Spinner?new Spinner(38,2).html.replace('wds-block','wds-spinner__block').replace('wds-path','wds-spinner__stroke'):''},{type:'div',classes:['helpPanel-close'],events:{click:$.proxy(this.togglePanelClose,this)},children:[window.dev.wds.icon('close')],data:{tracking:'CTA-close'}},{type:'div',classes:['helpPanel-contents'],children:[this.renderStepOne(),this.renderStepTwo(),this.renderStepThree()]}]}));mw.hook('HelpPanel.ui').fire();},renderStepOne:function(){return{type:'div',attr:{id:'hp-step1'},classes:['showHP-step'],children:[{type:'div',attr:{id:'helpPanelHead'},children:[{type:'div',classes:['helpPanel-question'],children:[window.dev.wds.icon('question')],},{type:'h3',text:this.i18n.msg('get-help2').plain()}]},{type:'div',attr:{id:'helpPanel-main'},children:[{type:'h4',text:this.i18n.msg('top-help-pages').plain()},{type:'ul',children:this.
helpPages.map(this.mapHelpPage,this)},{type:'p',children:[this.mapHelpPage('more-help-articles')]}]},{type:'div',attr:{id:'helpPanel-forum'},children:[{type:'div',html:this.i18n.msg('not-here').parse()},{type:'div',attr:{id:'helpPanel-buttons'},children:[{type:'button',classes:['wikia-button'],data:{tracking:'ask-on-forum'},events:{click:$.proxy(this.waitForIP,this)},text:this.i18n.msg('ask').plain()}]}]}]};},renderStepTwo:function(){return{type:'div',attr:{id:'hp-step2'},children:[{type:'div',attr:{id:'helpPanelHead'},children:[{type:'div',classes:['helpPanel-question'],children:[window.dev.wds.icon('question')]},{type:'h3',text:this.i18n.msg('ask').plain()}]},{type:'div',attr:{id:'helpPanel-main'},children:[{type:'p',attr:{id:'helpPanel-post-text'}}]},{type:'div',classes:['helpPanel-forumForm'],attr:{id:'helpPanel-forum'},children:[{type:'p',html:this.i18n.msg(this.config.wgUserName?'reply-info':'reply-info-anon').parse().replace('$1',window.dev.wds.icon('message').outerHTML),},{type
:'h4',text:this.i18n.msg('ask-header').plain()},{type:'div',text:this.i18n.msg('question-error').plain(),classes:['error-msg']},{type:'textarea',attr:{id:'hp-forum-textarea',tabindex:'0',data:{tracking:'post-done'},'aria-disabled':'false',rows:'3',placeholder:this.i18n.msg('ask-placeholder').plain()}},{type:'input',attr:{type:'checkbox',id:'helpPanel-check',name:'include-title',checked:'checked'}},{type:'label',attr:{'for':'helpPanel-check'},text:this.i18n.msg('include-title').plain()},{type:'div',attr:{id:'helpPanel-buttons'},children:[{type:'button',classes:['wikia-button','secondary'],text:this.i18n.msg('back').plain(),data:{tracking:'forum-question-back'},events:{click:$.proxy(this.toggleStep1,this)}},{type:'button',classes:['wikia-button'],text:this.i18n.msg('submit').plain(),data:{tracking:'forum-question-submitted'},events:{click:$.proxy(this.submitPost,this)}}]}]}]};},renderStepThree:function(){return{type:'div',attr:{id:'hp-step3'},children:[{type:'div',attr:{id:
'helpPanelHead'},children:[{type:'div',classes:['helpPanel-question'],children:[window.dev.wds.icon('question')]},{type:'h3',text:this.i18n.msg('ask').plain()}]},{type:'div',attr:{id:'helpPanel-main'},children:[{type:'h4',children:[{type:'span',children:[window.dev.wds.icon('checkmark')]},{type:'span',classes:['successmsg'],text:this.i18n.msg('success-header').plain()}]},{type:'p',text:this.i18n.msg('success-message-intro').plain()},{type:'p',html:this.i18n.msg(this.config.wgUserName?'success-message':'success-message-anon').parse().replace('$1',window.dev.wds.icon('message').outerHTML),},{type:'p',children:[{type:'a',attr:{href:'#',id:'helpPanel-post-link',target:'_blank'},data:{tracking:'post-link'},text:this.i18n.msg('forum-link').plain()}]}]},{type:'div',attr:{id:'helpPanel-forum'},children:[{type:'div',attr:{id:'helpPanel-buttons'},children:[{type:'button',classes:['wikia-button'],attr:{'aria-diabled':'false',tabindex:'0',},text:this.i18n.msg('done').plain(),events:{click:$.proxy(
this.done,this)}}]}]}]};},mapHelpPage:function(page){var linkMsg=page==='general-editing-help'?this.config.wgIsEditPage?'classic-page':'visual-page':page+'-page';return{type:'li',children:[{type:'a',attr:{href:mw.util.getUrl(this.i18n.inContentLang().msg(linkMsg).plain()),target:'_blank',title:page},classes:['helpPanel-help-page-link'],text:this.i18n.msg(page).plain()}]};},destroyVisualEditor:function(){$('#helpPanelCTA').remove();},track:function(action,label,args){tracker.track($.extend({trackingMethod:'analytics',category:'help-panel',action:action,label:label+(this.config.wgUserName?'':'-anon')},args));},addTracking:function(){if(!tracker){return;}this.track(tracker.ACTIONS.VIEW,'editor-loaded',{noninteraction:!0});$('body').on('click','#helpPanelCTA',$.proxy(this.trackOpenModal,this)).on('click','#helpPanel .helpPanel-close',$.proxy(this.trackCloseModal,this)).on('click','#helpPanel [data-tracking]',$.proxy(this.trackButtonClick,this)).on('click',
'#helpPanel .helpPanel-help-page-link',$.proxy(this.trackHelpPageClick,this));},trackOpenModal:function(){this.track(tracker.ACTIONS.CLICK,'toggle-panel-open');},trackCloseModal:function(){this.track(tracker.ACTIONS.CLICK,'toggle-panel-close');},trackButtonClick:function(event){this.track(tracker.ACTIONS.CLICK,'button-'+$(event.target).attr('data-tracking'));},trackHelpPageClick:function(event){this.track(tracker.ACTIONS.CLICK,'article-'+$(event.target).attr('title'));}};mw.hook('dev.ui').add($.proxy(HelpPanel.preload,HelpPanel));mw.hook('dev.i18n').add($.proxy(HelpPanel.preload,HelpPanel));mw.hook('dev.wds').add($.proxy(HelpPanel.preload,HelpPanel));importArticles({type:'script',articles:['u:dev:MediaWiki:I18n-js/code.js','u:dev:MediaWiki:UI-js/code.js','u:dev:MediaWiki:WDSIcons/code.js']},{type:'style',articles:['u:dev:MediaWiki:InEditorHelp.css']});});;(function(){var user=$('#UserProfileMasthead h1').text();if(!$('#UserProfileMasthead').exists()||$('#discussionAllPostsByUser').
exists()||window.LTDPITDHLPLoaded||mw.util.isIPv4Address(user)||mw.util.isIPv6Address(user)){return;}window.LTDPITDHLPLoaded=!0;$.getJSON(mw.util.wikiScript('api'),{action:'query',list:'users',ususers:user,format:'json'}).done(function(data){$('.discussion-details > em, .discussion-label').wrapAll($('<a>',{href:mw.config.get('wgScriptPath')+'/f/u/'+data.query.users[0].userid}));});})();;require(['jquery','mw','wikia.window'],function($,mw,window){if(mw.config.get('wgUserName')||$('#MyStory').exists()||window.myStoryLoaded){return;}window.myStoryLoaded=!0;importArticles({type:'style',articles:['u:dev:MediaWiki:FandomIcons.css','u:dev:MediaWiki:MyStory.css']});$.ajax({url:'https://dev.fandom.com/api.php',data:{action:'query',meta:'allmessages',ammessages:'Custom-MyStory',format:'json'},dataType:'jsonp',success:function(data){var myStory=JSON.parse(data.query.allmessages[0]["*"]);var _keys=Object.keys(myStory);window.myStoryUser=_keys[Math.floor(Math.random()*_keys.length)];window.
myStoryMessage=myStory[window.myStoryUser];$.getJSON('/api/v1/User/Details/avatar',{ids:window.myStoryUser,size:50}).then(function(data){window.myStoryAvatar=data.items[0].avatar;$('<section>',{'class':'rail-module',id:'mystory'}).append($('<h2>',{text:'My Fandom Story'}).prepend($('<span>',{'class':'fandom-icons',text:'💙'})),$('<div>',{'class':'wds-avatar',title:window.myStoryUser}).prepend($('<img>',{src:window.myStoryAvatar,alt:window.myStoryUser,'class':'wds-avatar__image'})),$('<div>').append($('<a>',{href:'https://community.fandom.com/wiki/User:'+window.myStoryUser,'class':'wds-midlight-aqua',text:window.myStoryUser.replace(/_/g,' ')})),$('<div>',{'class':'mystory--content'}).append(document.createTextNode(window.myStoryMessage),$('<div>',{'class':'mystory--link'}).append($('<a>',{href:'https://bit.ly/fandom-signin',html:'Create an account to start<br />your experience today!'})))).prependTo('#WikiaRail');});}});});;require(['wikia.window','mw','jquery',
'ext.wikia.design-system.loading-spinner'],function(window,mw,$,Spinner){'use strict';var $cc=$('#mw-content-text'),i18n,$throbber,config=mw.config.get(['stylepath','wgPageName']),$sel=$('.UserProfileActionButton .WikiaMenuElement, .page-header__contribution-buttons .wds-list').first(),spinnerHTML=new Spinner(38,2).html.replace('wds-block','wds-spinner__block').replace('wds-path','wds-spinner__stroke');if(!$sel.exists()||!$('#ca-edit').exists()||window.NullEditButtonLoaded){return;}window.NullEditButtonLoaded=!0;function finish(cls,msg){$throbber.remove();$('#ca-null-edit').text(i18n.msg('text').plain());new BannerNotification(i18n.msg(msg).escape(),cls).show();}function getPage(){$('#null-edit-text').text(i18n.msg('getting').plain());$cc.load(window.location.href+' #mw-content-text',function(){finish('confirm','success');mw.hook('wikipage.content').fire($cc);});}function onError(){finish('error','failed');}function edit(){$throbber=$('<div>',{id:'null-edit-throbber',css:{background:
'rgba(255, 255, 255, 0.5)',position:'fixed',height:'100%',width:'100%',left:'0',top:'0','z-index':'1000000000'},html:spinnerHTML}).appendTo(document.body);$('#ca-null-edit').html($('<img>',{id:'null-edit-throbber',src:config.stylepath+'/common/images/ajax.gif'}),$('<span>',{id:'null-edit-text',text:i18n.msg('editing').plain()}));new mw.Api().post({action:'edit',title:config.wgPageName,token:mw.user.tokens.get('editToken'),prependtext:''}).done(getPage).fail(onError);return false;}function addButton(i18nData){i18n=i18nData;i18n.useUserLang();$sel.append($('<li>').append($('<a>',{href:'#',accesskey:'0',id:'ca-null-edit',text:i18n.msg('text').plain(),title:i18n.msg('tooltip').plain()}).click(edit)));}if(!window.dev||!window.dev.i18n){importArticle({type:'script',article:'u:dev:MediaWiki:I18n-js/code.js'});}mw.hook('dev.i18n').add(function(i18no){$.when(i18no.loadMessages('NullEditButton'),mw.loader.using('mediawiki.api')).then(addButton);});});;(function($,mw){'use strict';var conf=mw.
config.get(['debug','wgAction','wgCanonicalSpecialPageName','wgNamespaceNumber','wgTitle','wgUserName']),noHideTags=!!((window.dev||{}).profileTags||{}).noHideTags;function hideTags($masthead){var $tags=$masthead.find('.tag');$tags.hide();}function getTagClass(tag){var tagClass='tag-'+tag.toLowerCase().replace(/\s/g,'_');return tagClass;}function getLinkTag($span,tag){var re=/\[\[(.+?)\|(.+?)\]\]/,match=re.exec(tag),href=mw.util.wikiGetlink(match[1]),text=match[2],$a=$('<a>').attr('href',href).css('color','inherit').text(text);$span.addClass(getTagClass(tag)).append($a);return $span;}function addProfileTags(tags){var $masthead=$('.UserProfileMasthead hgroup'),linkTestRe=/\[\[.+?\|.+?\]\]/;if(!noHideTags){hideTags($masthead);}tags.forEach(function(tag){var $span=$('<span>').addClass('tag');if(linkTestRe.test(tag)){$span=getLinkTag($span,tag);}else{$span.addClass(getTagClass(tag)).text(tag);}$masthead.append($span,' ');});mw.hook('dev.profile-tags').fire();}function getUserName(){var user
=conf.wgTitle,target=$.getUrlVar('target'),parts;if(conf.wgCanonicalSpecialPageName==='Contributions'){parts=user.split('/');if(parts.length===2){user=parts[1];}else if(target){user=decodeURIComponent(target).replace(/_/g,' ');}else{user=conf.wgUserName;if(user===null){user='';}}}return user;}function getUserTags(){var params={action:'raw',title:'MediaWiki:ProfileTags'};if(conf.debug){params.maxage=0;params.smaxage=0;}$.get(mw.util.wikiScript(),params,function(data){if(!data.length){return;}var user=$.escapeRE(getUserName()),re=new RegExp('(?:^|\\n)\\s*'+user+'\\s*\\|\\s*(.*?)\\s*(?:\\n|$)'),match=re.exec(data),tags;if(match===null){return;}tags=match[1].split(/\s*,\s*/);if(tags.length){addProfileTags(tags);}});}function init(){if($('.UserProfileMasthead').length){mw.loader.using(['mediawiki.util','site'],getUserTags);}}$(init);}(jQuery,mediaWiki));;(function(window,$,mw){window.dev=window.dev||{};if(mw.user.options.get('editor')==='1'||window.dev.sourceEditBtn){return;}window.dev.
sourceEditBtn={};var conf=mw.config.get(['wgPageName','wgNamespaceNumber']);function sourceEditBtnInit(){window.dev.sourceEditBtn=new SourceEditButton();}function SourceEditButton(){window.dev.fetch('option-source-editor').then($.proxy(this.ui,this));}SourceEditButton.prototype.ui=function(d){$('<li>',{append:$('<a>',{href:mw.util.getUrl(conf.wgPageName,{action:'edit',useeditor:'source'}),text:d,})}).insertAfter($(this.wrapper).find('a[id$="edit"]').first().parent());};SourceEditButton.prototype.wrapper=[2,3].indexOf(conf.wgNamespaceNumber)>-1?'.UserProfileActionButton > .wikia-menu-button > ul':'.page-header__contribution-buttons .wds-list';mw.hook('dev.fetch').add(sourceEditBtnInit);importArticle({article:'u:dev:MediaWiki:Fetch.js',type:'script'});})(this,jQuery,mediaWiki);;$(function(){'use strict';var $textarea=$('#wpSummary');if(!$textarea.length||document.getElementById('stdSummaries'))return;var presets=(window.dev&&window.dev.editSummaries)||{},select=presets.select||
'Template:Stdsummaries';$textarea.attr('tabindex','3');$('#wpMinoredit').attr('tabindex','4');$('#wpSave').attr('tabindex','5');var $summary=$('#wpSummaryEnhanced');if(!$summary.length)$summary=$textarea;if('css'in presets){mw.util.addCSS(presets.css);}else{importArticle({type:'style',article:'u:dev:MediaWiki:Standard_Edit_Summary.css'});}var $combo=$('<select id="stdSummaries" tabindex="2"></select>').insertAfter($textarea).change(function(){$summary.val($(this).val());});function flatten(options,indent){var flattened=[];indent=indent||'';for(var i=0;i<options.length;i++){if($.isArray(options[i])){flattened=flattened.concat(flatten(options[i],'-- '));}else{flattened.push(indent+options[i]);}}return flattened;}function render(lines){var options='',selected=' selected',ignore={':':1,'*':1,'<':1};for(var i=0;i<lines.length;i++,selected=''){if(!lines[i].length||ignore[lines[i][0]]){continue;}if(lines[i].substring(0,3)==='-- '){var contents=mw.html.escape(lines[i].substring(3));options+=
'<option value="'+contents+'"'+selected+'>&nbsp;&nbsp;'+contents+'</option>';}else{options+='<option value="" disabled'+selected+'>'+mw.html.escape(lines[i])+'</option>';}}$combo.append(options);}if(typeof select==='string'){$.get(mw.util.getUrl(select,{action:'raw'})).done(function(data){render(data.split(/\r\n|\n|\r/));});}else if(Array.isArray(select)){render(flatten(select));}});;require(['wikia.window','jquery','mw'],function(window,$,mw){var config=mw.config.get(['wgScriptPath','wgCanonicalSpecialPageName']);if(config.wgCanonicalSpecialPageName!=='Community'||$('#wiki-manager-module').length){return;}function wikiManagerModule(wds,i18n){var api=new mw.Api();api.get({action:'query',meta:'allmessages',ammessages:'custom-Wiki_Manager'}).done(function(r,s){if(s!=='success'||!r.query){return;}api.get({action:'query',list:'users',ususers:r.query.allmessages[0]['*'],usprop:'groups'}).done(function(r,s){if(s!=='success'||!r.query){return;}var user=r.query.users[0];$.getJSON(config.
wgScriptPath+'/api/v1/User/Details',{ids:user.userid,size:50}).done(function(r,s){if(s!=='success'||!r.items){return;}var user2=r.items[0],badge=user.groups.includes('staff')?'staff':user.groups.includes('helper')?'helper':undefined;if(badge){badge={badgeText:badge,badgeMarkup:wds.badge(badge,{width:18}).outerHTML};}require(['wikia.mustache','communitypage.templates.mustache'],function(mustache,templates){$(mustache.render(templates.adminsModule,{topAdminsData:{topAdminsHeaderText:i18n.msg('wiki-manager').plain(),topAdminsList:[{avatar:'<img src="'+user2.avatar+'">',badge:badge,profilePage:user2.url,userName:user.name}],adminsText:'<a href="https://community.fandom.com/wiki/Help:Wiki_Managers">'+i18n.msg('wiki-manager_desc').escape()+'</a>'}},{topAdmins:templates.topAdmins.replace(/([^{]){{adminsText}}([^}])/,'$1{{{adminsText}}}$2')})).attr('id','wiki-manager-module').insertAfter('.community-page-admins-module');});});});});}$.when(new $.Deferred(function(deferred){if(window.dev&&
window.dev.wds){deferred.resolve(window.dev.wds);}else{mw.hook('dev.wds').add(function(wds){deferred.resolve(wds);});importArticle({type:'script',article:'u:dev:MediaWiki:WDSIcons/code.js'});}}),new $.Deferred(function(deferred){if(window.dev&&window.dev.i18n){window.dev.i18n.loadMessages('WikiManager_Nameplate').done(deferred.resolve);}else{mw.hook('dev.i18n').add(function(i18n){i18n.loadMessages('WikiManager_Nameplate').done(deferred.resolve);});importArticle({type:'script',article:'u:dev:MediaWiki:I18n-js/code.js'});}}),mw.loader.using(['mediawiki.api','mediawiki.util'])).done(wikiManagerModule);});;require(['jquery','mw'],function($,mw){'use strict';var config=mw.config.get(['wgCanonicalSpecialPageName','wgNamespaceNumber']);var isWhatLinksHere=config.wgCanonicalSpecialPageName==='Whatlinkshere';var isFilePage=config.wgNamespaceNumber===6;var i18n;if(window.WLHEditLinksLoaded||!(isWhatLinksHere||isFilePage)){return;}window.WLHEditLinksLoaded=!0;function addEditLinks(selector,
className){$(selector).each(function(){var $elem=$(this);$('<span>',{class:className}).before(' ').append('(').append($('<a/>',{text:i18n.msg('edit-link-label').plain(),href:new mw.Uri($elem.attr('href')).extend({action:'edit'}).toString()})).append(')').insertAfter($elem);});}function addEditLinksToWhatLinksHere(){var selector='#mw-whatlinkshere-list li a:not([title="Special:WhatLinksHere"]):not([title*="Thread:"]):not([title*="Message Wall:"]):not([title*="Board:"])';var className='mw-whatlinkshere-edit';addEditLinks(selector,className);}function addEditLinksToFilePages(){var selector='.grid-3 a';var className='mw-imagepage-section-linkstoimage-edit';addEditLinks(selector,className);var pageListContent=document.querySelector('.page-list-content');var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){mutation.removedNodes.forEach(function(node){if($(node).hasClass('wikiaThrobber')){addEditLinks(selector,className);}});});});if(pageListContent){
observer.observe(pageListContent,{childList:!0});}}mw.hook('dev.i18n').add(function(i18nObject){i18nObject.loadMessages('WLHEditLinks').done(function(messages){i18n=messages;if(isWhatLinksHere){addEditLinksToWhatLinksHere();}if(isFilePage){addEditLinksToFilePages();}});});importArticles({type:'script',articles:['u:dev:MediaWiki:I18n-js/code.js']});});;;mw.loader.state({"wikia.fake.articles.53256ae425d578fc2b6b98eff14e66d2":"ready"});

/* cache key: elderscrolls:resourceloader:filter:minify-js:7:37c501d11aa1d36c9a25d381c3f10447 */